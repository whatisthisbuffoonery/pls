<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Beej's Guide to C Programming</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!-- BG custom styling -->
  <style type="text/css">
  /* Fix for line numbers not visible */
  pre.numberSource code > span {
      left: -1em;
  }
  pre.numberSource {
      margin-left: initial;
  }

  /* Put some space after the section numbers */
  span.toc-section-number::after {
      content: "\a0\a0\a0";  /* non-breaking whitespace */
  }

  /* Hide underlines on code number links */
  pre > code.sourceCode > span > a:first-child::before {
      text-decoration: none;
  }

  /* Color the source blocks */
  div.sourceCode {
      background-color: #f0f0f0;
  }

  /* Fix iOS big text rendering issue */
  pre > code.sourceCode > span {
      display: initial;
  }


  /* Color the inline code */
  code:not(.sourceCode) {
      background: #f0f0f0;
      padding-left: 0.2em;
      padding-right: 0.2em;
      border-radius: 0.2em;
  }

  pre.sourceCode {
      border: 1px solid #ccc;
      padding: 0.5em;
      border-radius: 0.2em;
  }

  /* Keep code tags from wrapping in tables */
  tbody code {
      white-space: nowrap;
  }

  /* Prevent hyphenation and hyphen breaks in code*/
  code {
      word-break: keep-all;
  }

  td {
      vertical-align: top;
  }

  body {
      font-size: 12pt;
      max-width: 43em;
      font-family: sans-serif;
  }

  html {
      background: #f9f9f9;
  }

  figure > embed {
      max-width: 100%;
  }

  figure {
      text-align: center;
      margin-top: 2em;
      margin-bottom: 2em;
  }

  figcaption {
      font-size: 0.9em;
      font-style: italic;
      margin-top: 0.6em;
  }

  body {
      counter-reset: figure-counter-major;
      counter-reset: figure-counter-minor;
  }

  figure {
      counter-increment: figure-counter-minor;
  }

  figcaption::before {
      content: "Figure " counter(figure-counter-major) "." counter(figure-counter-minor) ": ";
  }

  blockquote {
      border-left: 2px solid #bbb;
      color: #444;
  }

  /* Contents */

  nav[role="doc-toc"] > ul > li {
    font-weight: bold;
    margin-top: 1.2em;
  }

  nav[role="doc-toc"] > ul > li:first {
    font-weight: bold;
    margin-top: initial;
  }

  nav[role="doc-toc"] > ul > li > ul {
    font-weight: normal;
    margin-top: 0.3em;
  }

  /*
  In multipage, we need to reset the figure counter to the chapter
  number. Luckily, this is in the <h1 data-number> attribute. Unluckily,
  there is no way to get this in a general way.

  This doesn't work:

    h1[data-number] {
      counter-set: figure-counter-major attr(data-number);
    }

  Nor this:

    h1[data-number] {
      --figure-counter-major-value: attr(data-number);
      counter-set: figure-counter-major var(--figure-counter-major-value);
    }

  So, dumbly, we have a bunch of rules for all these sections, up to the
  maximum possible section.

  Here's a program to generate them:

    for (let i = 1; i < 100; i++)
        console.log(`h1[data-number="${i}"]{counter-set:figure-counter-major ${i};counter-reset:figure-counter-minor;}`);

  Note to self: never write a book with more than 99 frickin' chapters.
  */

  h1[data-number="1"]{counter-set:figure-counter-major 1;counter-reset:figure-counter-minor;}
  h1[data-number="2"]{counter-set:figure-counter-major 2;counter-reset:figure-counter-minor;}
  h1[data-number="3"]{counter-set:figure-counter-major 3;counter-reset:figure-counter-minor;}
  h1[data-number="4"]{counter-set:figure-counter-major 4;counter-reset:figure-counter-minor;}
  h1[data-number="5"]{counter-set:figure-counter-major 5;counter-reset:figure-counter-minor;}
  h1[data-number="6"]{counter-set:figure-counter-major 6;counter-reset:figure-counter-minor;}
  h1[data-number="7"]{counter-set:figure-counter-major 7;counter-reset:figure-counter-minor;}
  h1[data-number="8"]{counter-set:figure-counter-major 8;counter-reset:figure-counter-minor;}
  h1[data-number="9"]{counter-set:figure-counter-major 9;counter-reset:figure-counter-minor;}
  h1[data-number="10"]{counter-set:figure-counter-major 10;counter-reset:figure-counter-minor;}
  h1[data-number="11"]{counter-set:figure-counter-major 11;counter-reset:figure-counter-minor;}
  h1[data-number="12"]{counter-set:figure-counter-major 12;counter-reset:figure-counter-minor;}
  h1[data-number="13"]{counter-set:figure-counter-major 13;counter-reset:figure-counter-minor;}
  h1[data-number="14"]{counter-set:figure-counter-major 14;counter-reset:figure-counter-minor;}
  h1[data-number="15"]{counter-set:figure-counter-major 15;counter-reset:figure-counter-minor;}
  h1[data-number="16"]{counter-set:figure-counter-major 16;counter-reset:figure-counter-minor;}
  h1[data-number="17"]{counter-set:figure-counter-major 17;counter-reset:figure-counter-minor;}
  h1[data-number="18"]{counter-set:figure-counter-major 18;counter-reset:figure-counter-minor;}
  h1[data-number="19"]{counter-set:figure-counter-major 19;counter-reset:figure-counter-minor;}
  h1[data-number="20"]{counter-set:figure-counter-major 20;counter-reset:figure-counter-minor;}
  h1[data-number="21"]{counter-set:figure-counter-major 21;counter-reset:figure-counter-minor;}
  h1[data-number="22"]{counter-set:figure-counter-major 22;counter-reset:figure-counter-minor;}
  h1[data-number="23"]{counter-set:figure-counter-major 23;counter-reset:figure-counter-minor;}
  h1[data-number="24"]{counter-set:figure-counter-major 24;counter-reset:figure-counter-minor;}
  h1[data-number="25"]{counter-set:figure-counter-major 25;counter-reset:figure-counter-minor;}
  h1[data-number="26"]{counter-set:figure-counter-major 26;counter-reset:figure-counter-minor;}
  h1[data-number="27"]{counter-set:figure-counter-major 27;counter-reset:figure-counter-minor;}
  h1[data-number="28"]{counter-set:figure-counter-major 28;counter-reset:figure-counter-minor;}
  h1[data-number="29"]{counter-set:figure-counter-major 29;counter-reset:figure-counter-minor;}
  h1[data-number="30"]{counter-set:figure-counter-major 30;counter-reset:figure-counter-minor;}
  h1[data-number="31"]{counter-set:figure-counter-major 31;counter-reset:figure-counter-minor;}
  h1[data-number="32"]{counter-set:figure-counter-major 32;counter-reset:figure-counter-minor;}
  h1[data-number="33"]{counter-set:figure-counter-major 33;counter-reset:figure-counter-minor;}
  h1[data-number="34"]{counter-set:figure-counter-major 34;counter-reset:figure-counter-minor;}
  h1[data-number="35"]{counter-set:figure-counter-major 35;counter-reset:figure-counter-minor;}
  h1[data-number="36"]{counter-set:figure-counter-major 36;counter-reset:figure-counter-minor;}
  h1[data-number="37"]{counter-set:figure-counter-major 37;counter-reset:figure-counter-minor;}
  h1[data-number="38"]{counter-set:figure-counter-major 38;counter-reset:figure-counter-minor;}
  h1[data-number="39"]{counter-set:figure-counter-major 39;counter-reset:figure-counter-minor;}
  h1[data-number="40"]{counter-set:figure-counter-major 40;counter-reset:figure-counter-minor;}
  h1[data-number="41"]{counter-set:figure-counter-major 41;counter-reset:figure-counter-minor;}
  h1[data-number="42"]{counter-set:figure-counter-major 42;counter-reset:figure-counter-minor;}
  h1[data-number="43"]{counter-set:figure-counter-major 43;counter-reset:figure-counter-minor;}
  h1[data-number="44"]{counter-set:figure-counter-major 44;counter-reset:figure-counter-minor;}
  h1[data-number="45"]{counter-set:figure-counter-major 45;counter-reset:figure-counter-minor;}
  h1[data-number="46"]{counter-set:figure-counter-major 46;counter-reset:figure-counter-minor;}
  h1[data-number="47"]{counter-set:figure-counter-major 47;counter-reset:figure-counter-minor;}
  h1[data-number="48"]{counter-set:figure-counter-major 48;counter-reset:figure-counter-minor;}
  h1[data-number="49"]{counter-set:figure-counter-major 49;counter-reset:figure-counter-minor;}
  h1[data-number="50"]{counter-set:figure-counter-major 50;counter-reset:figure-counter-minor;}
  h1[data-number="51"]{counter-set:figure-counter-major 51;counter-reset:figure-counter-minor;}
  h1[data-number="52"]{counter-set:figure-counter-major 52;counter-reset:figure-counter-minor;}
  h1[data-number="53"]{counter-set:figure-counter-major 53;counter-reset:figure-counter-minor;}
  h1[data-number="54"]{counter-set:figure-counter-major 54;counter-reset:figure-counter-minor;}
  h1[data-number="55"]{counter-set:figure-counter-major 55;counter-reset:figure-counter-minor;}
  h1[data-number="56"]{counter-set:figure-counter-major 56;counter-reset:figure-counter-minor;}
  h1[data-number="57"]{counter-set:figure-counter-major 57;counter-reset:figure-counter-minor;}
  h1[data-number="58"]{counter-set:figure-counter-major 58;counter-reset:figure-counter-minor;}
  h1[data-number="59"]{counter-set:figure-counter-major 59;counter-reset:figure-counter-minor;}
  h1[data-number="60"]{counter-set:figure-counter-major 60;counter-reset:figure-counter-minor;}
  h1[data-number="61"]{counter-set:figure-counter-major 61;counter-reset:figure-counter-minor;}
  h1[data-number="62"]{counter-set:figure-counter-major 62;counter-reset:figure-counter-minor;}
  h1[data-number="63"]{counter-set:figure-counter-major 63;counter-reset:figure-counter-minor;}
  h1[data-number="64"]{counter-set:figure-counter-major 64;counter-reset:figure-counter-minor;}
  h1[data-number="65"]{counter-set:figure-counter-major 65;counter-reset:figure-counter-minor;}
  h1[data-number="66"]{counter-set:figure-counter-major 66;counter-reset:figure-counter-minor;}
  h1[data-number="67"]{counter-set:figure-counter-major 67;counter-reset:figure-counter-minor;}
  h1[data-number="68"]{counter-set:figure-counter-major 68;counter-reset:figure-counter-minor;}
  h1[data-number="69"]{counter-set:figure-counter-major 69;counter-reset:figure-counter-minor;}
  h1[data-number="70"]{counter-set:figure-counter-major 70;counter-reset:figure-counter-minor;}
  h1[data-number="71"]{counter-set:figure-counter-major 71;counter-reset:figure-counter-minor;}
  h1[data-number="72"]{counter-set:figure-counter-major 72;counter-reset:figure-counter-minor;}
  h1[data-number="73"]{counter-set:figure-counter-major 73;counter-reset:figure-counter-minor;}
  h1[data-number="74"]{counter-set:figure-counter-major 74;counter-reset:figure-counter-minor;}
  h1[data-number="75"]{counter-set:figure-counter-major 75;counter-reset:figure-counter-minor;}
  h1[data-number="76"]{counter-set:figure-counter-major 76;counter-reset:figure-counter-minor;}
  h1[data-number="77"]{counter-set:figure-counter-major 77;counter-reset:figure-counter-minor;}
  h1[data-number="78"]{counter-set:figure-counter-major 78;counter-reset:figure-counter-minor;}
  h1[data-number="79"]{counter-set:figure-counter-major 79;counter-reset:figure-counter-minor;}
  h1[data-number="80"]{counter-set:figure-counter-major 80;counter-reset:figure-counter-minor;}
  h1[data-number="81"]{counter-set:figure-counter-major 81;counter-reset:figure-counter-minor;}
  h1[data-number="82"]{counter-set:figure-counter-major 82;counter-reset:figure-counter-minor;}
  h1[data-number="83"]{counter-set:figure-counter-major 83;counter-reset:figure-counter-minor;}
  h1[data-number="84"]{counter-set:figure-counter-major 84;counter-reset:figure-counter-minor;}
  h1[data-number="85"]{counter-set:figure-counter-major 85;counter-reset:figure-counter-minor;}
  h1[data-number="86"]{counter-set:figure-counter-major 86;counter-reset:figure-counter-minor;}
  h1[data-number="87"]{counter-set:figure-counter-major 87;counter-reset:figure-counter-minor;}
  h1[data-number="88"]{counter-set:figure-counter-major 88;counter-reset:figure-counter-minor;}
  h1[data-number="89"]{counter-set:figure-counter-major 89;counter-reset:figure-counter-minor;}
  h1[data-number="90"]{counter-set:figure-counter-major 90;counter-reset:figure-counter-minor;}
  h1[data-number="91"]{counter-set:figure-counter-major 91;counter-reset:figure-counter-minor;}
  h1[data-number="92"]{counter-set:figure-counter-major 92;counter-reset:figure-counter-minor;}
  h1[data-number="93"]{counter-set:figure-counter-major 93;counter-reset:figure-counter-minor;}
  h1[data-number="94"]{counter-set:figure-counter-major 94;counter-reset:figure-counter-minor;}
  h1[data-number="95"]{counter-set:figure-counter-major 95;counter-reset:figure-counter-minor;}
  h1[data-number="96"]{counter-set:figure-counter-major 96;counter-reset:figure-counter-minor;}
  h1[data-number="97"]{counter-set:figure-counter-major 97;counter-reset:figure-counter-minor;}
  h1[data-number="98"]{counter-set:figure-counter-major 98;counter-reset:figure-counter-minor;}
  h1[data-number="99"]{counter-set:figure-counter-major 99;counter-reset:figure-counter-minor;}


  </style>
  <!-- BG custom styling for the wide body variant -->
  <!-- Gets appended after bg-css.html -->

  <style type="text/css">
  body {
      max-width: inherit;
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>
<div style="text-align:center"><span><a href="signal-handling.html" rel="prev">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="goto.html" rel="next">Next</a></span></div><hr>
<h1 data-number="30" id="variable-length-arrays-vlas"><span class="header-section-number">30</span> Variable-Length Arrays (VLAs)</h1>
<p></p>
<p>C provides a way for you to declare an array whose size is determined at runtime. This gives you the benefits of dynamic runtime sizing like you get with <code>malloc()</code>, but without needing to worry about <code>free()</code>ing the memory after.</p>
<p>Now, a lot of people don’t like VLAs. They’ve been banned from the Linux kernel, for example. We’ll dig into more of that rationale <a href="variable-length-arrays-vlas.html#vla-general-issues">later</a>.</p>
<p></p>
<p>This is an optional feature of the language. The macro <code>__STDC_NO_VLA__</code> is set to <code>1</code> if VLAs are <em>not</em> present. (They were mandatory in C99, and then became optional in C11.)</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb591-1"><a href="variable-length-arrays-vlas.html#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_NO_VLA__ == 1</span></span>
<span id="cb591-2"><a href="variable-length-arrays-vlas.html#cb591-2" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#error Sorry, need VLAs for this program!</span></span>
<span id="cb591-3"><a href="variable-length-arrays-vlas.html#cb591-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p>But since neither GCC nor Clang bother to define this macro, you may get limited mileage from this.</p>
<p>Let’s dive in first with an example, and then we’ll look for the devil in the details.</p>
<h2 data-number="30.1" id="the-basics"><span class="header-section-number">30.1</span> The Basics</h2>
<p>A normal array is declared with a constant size, like this:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb592-1"><a href="variable-length-arrays-vlas.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> v<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span></code></pre></div>
<p></p>
<p>But with VLAs, we can use a size determined at runtime to set the array, like this:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb593-1"><a href="variable-length-arrays-vlas.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb593-2"><a href="variable-length-arrays-vlas.html#cb593-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> v<span class="op">[</span>n<span class="op">];</span></span></code></pre></div>
<p>Now, that looks like the same thing, and in many ways is, but this gives you the flexibility to compute the size you need, and then get an array of exactly that size.</p>
<p>Let’s ask the user to input the size of the array, and then store the index-times-10 in each of those array elements:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb594-1"><a href="variable-length-arrays-vlas.html#cb594-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb594-2"><a href="variable-length-arrays-vlas.html#cb594-2"></a></span>
<span id="cb594-3"><a href="variable-length-arrays-vlas.html#cb594-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb594-4"><a href="variable-length-arrays-vlas.html#cb594-4"></a><span class="op">{</span></span>
<span id="cb594-5"><a href="variable-length-arrays-vlas.html#cb594-5"></a>    <span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb594-6"><a href="variable-length-arrays-vlas.html#cb594-6"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">32</span><span class="op">];</span></span>
<span id="cb594-7"><a href="variable-length-arrays-vlas.html#cb594-7"></a></span>
<span id="cb594-8"><a href="variable-length-arrays-vlas.html#cb594-8"></a>    printf<span class="op">(</span><span class="st">&quot;Enter a number: &quot;</span><span class="op">);</span> fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb594-9"><a href="variable-length-arrays-vlas.html#cb594-9"></a>    fgets<span class="op">(</span>buf<span class="op">,</span> <span class="kw">sizeof</span> buf<span class="op">,</span> stdin<span class="op">);</span></span>
<span id="cb594-10"><a href="variable-length-arrays-vlas.html#cb594-10"></a>    n <span class="op">=</span> strtoul<span class="op">(</span>buf<span class="op">,</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb594-11"><a href="variable-length-arrays-vlas.html#cb594-11"></a></span>
<span id="cb594-12"><a href="variable-length-arrays-vlas.html#cb594-12"></a>    <span class="dt">int</span> v<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb594-13"><a href="variable-length-arrays-vlas.html#cb594-13"></a></span>
<span id="cb594-14"><a href="variable-length-arrays-vlas.html#cb594-14"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb594-15"><a href="variable-length-arrays-vlas.html#cb594-15"></a>        v<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb594-16"><a href="variable-length-arrays-vlas.html#cb594-16"></a></span>
<span id="cb594-17"><a href="variable-length-arrays-vlas.html#cb594-17"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb594-18"><a href="variable-length-arrays-vlas.html#cb594-18"></a>        printf<span class="op">(</span><span class="st">&quot;v[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> v<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb594-19"><a href="variable-length-arrays-vlas.html#cb594-19"></a><span class="op">}</span></span></code></pre></div>
<p>(On line 7, I have an <code>fflush()</code> that should force the line to output even though I don’t have a newline at the end.)</p>
<p>Line 12 is where we declare the VLA—once execution gets past that line, the size of the array is set to whatever <code>n</code> was at that moment. The array length can’t be changed later.</p>
<p>You can put an expression in the brackets, as well:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb595-1"><a href="variable-length-arrays-vlas.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> v<span class="op">[</span>x <span class="op">*</span> <span class="dv">100</span><span class="op">];</span></span></code></pre></div>
<p>Some restrictions:</p>
<ul>
<li>You can’t declare a VLA at file scope, and you can’t make a <code>static</code> one in block scope<a href="function-specifiers-alignment-specifiersoperators.html#fn175" class="footnote-ref" id="fnref175" role="doc-noteref"><sup>175</sup></a>.</li>
<li>You can’t use an initializer list to initialize the array.</li>
</ul>
<p>Also, entering a negative value for the size of the array invokes undefined behavior—in this universe, anyway.</p>
<p></p>
<h2 data-number="30.2" id="sizeof-and-vlas"><span class="header-section-number">30.2</span> <code>sizeof</code> and VLAs</h2>
<p></p>
<p>We’re used to <code>sizeof</code> giving us the size in bytes of any particular object, including arrays. And VLAs are no exception.</p>
<p>The main difference is that <code>sizeof</code> on a VLA is executed at <em>runtime</em>, whereas on a non-variably-sized variable it is computed at <em>compile time</em>.</p>
<p>But the usage is the same.</p>
<p>You can even compute the number of elements in a VLA with the usual array trick:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb596-1"><a href="variable-length-arrays-vlas.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> num_elems <span class="op">=</span> <span class="kw">sizeof</span> v <span class="op">/</span> <span class="kw">sizeof</span> v<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span></code></pre></div>
<p>There’s a subtle and correct implication from the above line: pointer arithmetic works just like you’d expect for a regular array. So go ahead and use it to your heart’s content:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb597-1"><a href="variable-length-arrays-vlas.html#cb597-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb597-2"><a href="variable-length-arrays-vlas.html#cb597-2"></a></span>
<span id="cb597-3"><a href="variable-length-arrays-vlas.html#cb597-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb597-4"><a href="variable-length-arrays-vlas.html#cb597-4"></a><span class="op">{</span></span>
<span id="cb597-5"><a href="variable-length-arrays-vlas.html#cb597-5"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb597-6"><a href="variable-length-arrays-vlas.html#cb597-6"></a>    <span class="dt">int</span> v<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb597-7"><a href="variable-length-arrays-vlas.html#cb597-7"></a></span>
<span id="cb597-8"><a href="variable-length-arrays-vlas.html#cb597-8"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb597-9"><a href="variable-length-arrays-vlas.html#cb597-9"></a></span>
<span id="cb597-10"><a href="variable-length-arrays-vlas.html#cb597-10"></a>    <span class="op">*(</span>p<span class="op">+</span><span class="dv">2</span><span class="op">)</span> <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb597-11"><a href="variable-length-arrays-vlas.html#cb597-11"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> v<span class="op">[</span><span class="dv">2</span><span class="op">]);</span>  <span class="co">// 12</span></span>
<span id="cb597-12"><a href="variable-length-arrays-vlas.html#cb597-12"></a></span>
<span id="cb597-13"><a href="variable-length-arrays-vlas.html#cb597-13"></a>    p<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">34</span><span class="op">;</span></span>
<span id="cb597-14"><a href="variable-length-arrays-vlas.html#cb597-14"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> v<span class="op">[</span><span class="dv">3</span><span class="op">]);</span>  <span class="co">// 34</span></span>
<span id="cb597-15"><a href="variable-length-arrays-vlas.html#cb597-15"></a><span class="op">}</span></span></code></pre></div>
<p>Like with regular arrays, you can use parentheses with <code>sizeof()</code> to get the size of a would-be VLA without actually declaring one:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb598-1"><a href="variable-length-arrays-vlas.html#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb598-2"><a href="variable-length-arrays-vlas.html#cb598-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-3"><a href="variable-length-arrays-vlas.html#cb598-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%zu\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span> <span class="op">[</span>x<span class="op">]));</span>  <span class="co">// Prints 48 on my system</span></span></code></pre></div>
<p></p>
<h2 data-number="30.3" id="multidimensional-vlas"><span class="header-section-number">30.3</span> Multidimensional VLAs</h2>
<p></p>
<p>You can go ahead and make all kinds of VLAs with one or more dimensions set to a variable</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb599-1"><a href="variable-length-arrays-vlas.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> w <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb599-2"><a href="variable-length-arrays-vlas.html#cb599-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> h <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb599-3"><a href="variable-length-arrays-vlas.html#cb599-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-4"><a href="variable-length-arrays-vlas.html#cb599-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">[</span>h<span class="op">][</span>w<span class="op">];</span></span>
<span id="cb599-5"><a href="variable-length-arrays-vlas.html#cb599-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y<span class="op">[</span><span class="dv">5</span><span class="op">][</span>w<span class="op">];</span></span>
<span id="cb599-6"><a href="variable-length-arrays-vlas.html#cb599-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> z<span class="op">[</span><span class="dv">10</span><span class="op">][</span>w<span class="op">][</span><span class="dv">20</span><span class="op">];</span></span></code></pre></div>
<p>Again, you can navigate these just like you would a regular array.</p>
<p></p>
<h2 data-number="30.4" id="passing-one-dimensional-vlas-to-functions"><span class="header-section-number">30.4</span> Passing One-Dimensional VLAs to Functions</h2>
<p></p>
<p>Passing single-dimensional VLAs into a function can be no different than passing a regular array in. You just go for it.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb600-1"><a href="variable-length-arrays-vlas.html#cb600-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb600-2"><a href="variable-length-arrays-vlas.html#cb600-2"></a></span>
<span id="cb600-3"><a href="variable-length-arrays-vlas.html#cb600-3"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>v<span class="op">)</span></span>
<span id="cb600-4"><a href="variable-length-arrays-vlas.html#cb600-4"></a><span class="op">{</span></span>
<span id="cb600-5"><a href="variable-length-arrays-vlas.html#cb600-5"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb600-6"><a href="variable-length-arrays-vlas.html#cb600-6"></a></span>
<span id="cb600-7"><a href="variable-length-arrays-vlas.html#cb600-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb600-8"><a href="variable-length-arrays-vlas.html#cb600-8"></a>        total <span class="op">+=</span> v<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb600-9"><a href="variable-length-arrays-vlas.html#cb600-9"></a></span>
<span id="cb600-10"><a href="variable-length-arrays-vlas.html#cb600-10"></a>    <span class="cf">return</span> total<span class="op">;</span></span>
<span id="cb600-11"><a href="variable-length-arrays-vlas.html#cb600-11"></a><span class="op">}</span></span>
<span id="cb600-12"><a href="variable-length-arrays-vlas.html#cb600-12"></a></span>
<span id="cb600-13"><a href="variable-length-arrays-vlas.html#cb600-13"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb600-14"><a href="variable-length-arrays-vlas.html#cb600-14"></a><span class="op">{</span></span>
<span id="cb600-15"><a href="variable-length-arrays-vlas.html#cb600-15"></a>    <span class="dt">int</span> x<span class="op">[</span><span class="dv">5</span><span class="op">];</span>   <span class="co">// Standard array</span></span>
<span id="cb600-16"><a href="variable-length-arrays-vlas.html#cb600-16"></a></span>
<span id="cb600-17"><a href="variable-length-arrays-vlas.html#cb600-17"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb600-18"><a href="variable-length-arrays-vlas.html#cb600-18"></a>    <span class="dt">int</span> y<span class="op">[</span>a<span class="op">];</span>   <span class="co">// VLA</span></span>
<span id="cb600-19"><a href="variable-length-arrays-vlas.html#cb600-19"></a></span>
<span id="cb600-20"><a href="variable-length-arrays-vlas.html#cb600-20"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> a<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb600-21"><a href="variable-length-arrays-vlas.html#cb600-21"></a>        x<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> y<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb600-22"><a href="variable-length-arrays-vlas.html#cb600-22"></a></span>
<span id="cb600-23"><a href="variable-length-arrays-vlas.html#cb600-23"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> sum<span class="op">(</span><span class="dv">5</span><span class="op">,</span> x<span class="op">));</span></span>
<span id="cb600-24"><a href="variable-length-arrays-vlas.html#cb600-24"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> sum<span class="op">(</span>a<span class="op">,</span> y<span class="op">));</span></span>
<span id="cb600-25"><a href="variable-length-arrays-vlas.html#cb600-25"></a><span class="op">}</span></span></code></pre></div>
<p>But there’s a bit more to it than that. You can also let C know that the array is a specific VLA size by passing that in first and then giving that dimension in the parameter list:</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb601-1"><a href="variable-length-arrays-vlas.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> v<span class="op">[</span>count<span class="op">])</span></span>
<span id="cb601-2"><a href="variable-length-arrays-vlas.html#cb601-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb601-3"><a href="variable-length-arrays-vlas.html#cb601-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb601-4"><a href="variable-length-arrays-vlas.html#cb601-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>Incidentally, there are a couple ways of listing a prototype for the above function; one of them involves an <code>*</code> if you don’t want to specifically name the value in the VLA. It just indicates that the type is a VLA as opposed to a regular pointer.</p>
<p>VLA prototypes:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb602-1"><a href="variable-length-arrays-vlas.html#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> do_something<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> v<span class="op">[</span>count<span class="op">]);</span>  <span class="co">// With names</span></span>
<span id="cb602-2"><a href="variable-length-arrays-vlas.html#cb602-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> do_something<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span> v<span class="op">[*]);</span>            <span class="co">// Without names</span></span></code></pre></div>
<p>Again, that <code>*</code> thing only works with the prototype—in the function itself, you’ll have to put the explicit size.</p>
<p> </p>
<p>Now—<em>let’s get multidimensional</em>! This is where the fun begins.</p>
<h2 data-number="30.5" id="passing-multi-dimensional-vlas-to-functions"><span class="header-section-number">30.5</span> Passing Multi-Dimensional VLAs to Functions</h2>
<p>Same thing as we did with the second form of one-dimensional VLAs, above, but this time we’re passing in two dimensions and using those.</p>
<p>In the following example, we build a multiplication table matrix of a variable width and height, and then pass it to a function to print it out.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb603-1"><a href="variable-length-arrays-vlas.html#cb603-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb603-2"><a href="variable-length-arrays-vlas.html#cb603-2"></a></span>
<span id="cb603-3"><a href="variable-length-arrays-vlas.html#cb603-3"></a><span class="dt">void</span> print_matrix<span class="op">(</span><span class="dt">int</span> h<span class="op">,</span> <span class="dt">int</span> w<span class="op">,</span> <span class="dt">int</span> m<span class="op">[</span>h<span class="op">][</span>w<span class="op">])</span></span>
<span id="cb603-4"><a href="variable-length-arrays-vlas.html#cb603-4"></a><span class="op">{</span></span>
<span id="cb603-5"><a href="variable-length-arrays-vlas.html#cb603-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> h<span class="op">;</span> row<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb603-6"><a href="variable-length-arrays-vlas.html#cb603-6"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> w<span class="op">;</span> col<span class="op">++)</span></span>
<span id="cb603-7"><a href="variable-length-arrays-vlas.html#cb603-7"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%2d</span><span class="st"> &quot;</span><span class="op">,</span> m<span class="op">[</span>row<span class="op">][</span>col<span class="op">]);</span></span>
<span id="cb603-8"><a href="variable-length-arrays-vlas.html#cb603-8"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb603-9"><a href="variable-length-arrays-vlas.html#cb603-9"></a>    <span class="op">}</span></span>
<span id="cb603-10"><a href="variable-length-arrays-vlas.html#cb603-10"></a><span class="op">}</span></span>
<span id="cb603-11"><a href="variable-length-arrays-vlas.html#cb603-11"></a></span>
<span id="cb603-12"><a href="variable-length-arrays-vlas.html#cb603-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb603-13"><a href="variable-length-arrays-vlas.html#cb603-13"></a><span class="op">{</span></span>
<span id="cb603-14"><a href="variable-length-arrays-vlas.html#cb603-14"></a>    <span class="dt">int</span> rows <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb603-15"><a href="variable-length-arrays-vlas.html#cb603-15"></a>    <span class="dt">int</span> cols <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb603-16"><a href="variable-length-arrays-vlas.html#cb603-16"></a></span>
<span id="cb603-17"><a href="variable-length-arrays-vlas.html#cb603-17"></a>    <span class="dt">int</span> matrix<span class="op">[</span>rows<span class="op">][</span>cols<span class="op">];</span></span>
<span id="cb603-18"><a href="variable-length-arrays-vlas.html#cb603-18"></a></span>
<span id="cb603-19"><a href="variable-length-arrays-vlas.html#cb603-19"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> rows<span class="op">;</span> row<span class="op">++)</span></span>
<span id="cb603-20"><a href="variable-length-arrays-vlas.html#cb603-20"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> cols<span class="op">;</span> col<span class="op">++)</span></span>
<span id="cb603-21"><a href="variable-length-arrays-vlas.html#cb603-21"></a>            matrix<span class="op">[</span>row<span class="op">][</span>col<span class="op">]</span> <span class="op">=</span> row <span class="op">*</span> col<span class="op">;</span></span>
<span id="cb603-22"><a href="variable-length-arrays-vlas.html#cb603-22"></a></span>
<span id="cb603-23"><a href="variable-length-arrays-vlas.html#cb603-23"></a>    print_matrix<span class="op">(</span>rows<span class="op">,</span> cols<span class="op">,</span> matrix<span class="op">);</span></span>
<span id="cb603-24"><a href="variable-length-arrays-vlas.html#cb603-24"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="30.5.1" id="partial-multidimensional-vlas"><span class="header-section-number">30.5.1</span> Partial Multidimensional VLAs</h3>
<p>You can have some of the dimensions fixed and some variable. Let’s say we have a record length fixed at 5 elements, but we don’t know how many records there are.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb604-1"><a href="variable-length-arrays-vlas.html#cb604-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb604-2"><a href="variable-length-arrays-vlas.html#cb604-2"></a></span>
<span id="cb604-3"><a href="variable-length-arrays-vlas.html#cb604-3"></a><span class="dt">void</span> print_records<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> record<span class="op">[</span>count<span class="op">][</span><span class="dv">5</span><span class="op">])</span></span>
<span id="cb604-4"><a href="variable-length-arrays-vlas.html#cb604-4"></a><span class="op">{</span></span>
<span id="cb604-5"><a href="variable-length-arrays-vlas.html#cb604-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb604-6"><a href="variable-length-arrays-vlas.html#cb604-6"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb604-7"><a href="variable-length-arrays-vlas.html#cb604-7"></a>            printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%2d</span><span class="st"> &quot;</span><span class="op">,</span> record<span class="op">[</span>i<span class="op">][</span>j<span class="op">]);</span></span>
<span id="cb604-8"><a href="variable-length-arrays-vlas.html#cb604-8"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb604-9"><a href="variable-length-arrays-vlas.html#cb604-9"></a>    <span class="op">}</span></span>
<span id="cb604-10"><a href="variable-length-arrays-vlas.html#cb604-10"></a><span class="op">}</span></span>
<span id="cb604-11"><a href="variable-length-arrays-vlas.html#cb604-11"></a></span>
<span id="cb604-12"><a href="variable-length-arrays-vlas.html#cb604-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb604-13"><a href="variable-length-arrays-vlas.html#cb604-13"></a><span class="op">{</span></span>
<span id="cb604-14"><a href="variable-length-arrays-vlas.html#cb604-14"></a>    <span class="dt">int</span> rec_count <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb604-15"><a href="variable-length-arrays-vlas.html#cb604-15"></a>    <span class="dt">int</span> records<span class="op">[</span>rec_count<span class="op">][</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb604-16"><a href="variable-length-arrays-vlas.html#cb604-16"></a></span>
<span id="cb604-17"><a href="variable-length-arrays-vlas.html#cb604-17"></a>    <span class="co">// Fill with some dummy data</span></span>
<span id="cb604-18"><a href="variable-length-arrays-vlas.html#cb604-18"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> rec_count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb604-19"><a href="variable-length-arrays-vlas.html#cb604-19"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb604-20"><a href="variable-length-arrays-vlas.html#cb604-20"></a>            records<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">)*(</span>j<span class="op">+</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb604-21"><a href="variable-length-arrays-vlas.html#cb604-21"></a></span>
<span id="cb604-22"><a href="variable-length-arrays-vlas.html#cb604-22"></a>    print_records<span class="op">(</span>rec_count<span class="op">,</span> records<span class="op">);</span></span>
<span id="cb604-23"><a href="variable-length-arrays-vlas.html#cb604-23"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="30.6" id="compatibility-with-regular-arrays"><span class="header-section-number">30.6</span> Compatibility with Regular Arrays</h2>
<p></p>
<p>Because VLAs are just like regular arrays in memory, it’s perfectly permissible to pass them interchangeably… as long as the dimensions match.</p>
<p>For example, if we have a function that specifically wants a <span class="math inline">\(3\times5\)</span> array, we can still pass a VLA into it.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb605-1"><a href="variable-length-arrays-vlas.html#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> foo<span class="op">(</span><span class="dt">int</span> m<span class="op">[</span><span class="dv">5</span><span class="op">][</span><span class="dv">3</span><span class="op">])</span> <span class="op">{...}</span></span>
<span id="cb605-2"><a href="variable-length-arrays-vlas.html#cb605-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-3"><a href="variable-length-arrays-vlas.html#cb605-3" aria-hidden="true" tabindex="-1"></a>\\ <span class="op">...</span></span>
<span id="cb605-4"><a href="variable-length-arrays-vlas.html#cb605-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-5"><a href="variable-length-arrays-vlas.html#cb605-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> w <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> h <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb605-6"><a href="variable-length-arrays-vlas.html#cb605-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> matrix<span class="op">[</span>h<span class="op">][</span>w<span class="op">];</span></span>
<span id="cb605-7"><a href="variable-length-arrays-vlas.html#cb605-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-8"><a href="variable-length-arrays-vlas.html#cb605-8" aria-hidden="true" tabindex="-1"></a>foo<span class="op">(</span>matrix<span class="op">);</span>   <span class="co">// OK!</span></span></code></pre></div>
<p>Likewise, if you have a VLA function, you can pass a regular array into it:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb606-1"><a href="variable-length-arrays-vlas.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> foo<span class="op">(</span><span class="dt">int</span> h<span class="op">,</span> <span class="dt">int</span> w<span class="op">,</span> <span class="dt">int</span> m<span class="op">[</span>h<span class="op">][</span>w<span class="op">])</span> <span class="op">{...}</span></span>
<span id="cb606-2"><a href="variable-length-arrays-vlas.html#cb606-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb606-3"><a href="variable-length-arrays-vlas.html#cb606-3" aria-hidden="true" tabindex="-1"></a>\\ <span class="op">...</span></span>
<span id="cb606-4"><a href="variable-length-arrays-vlas.html#cb606-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb606-5"><a href="variable-length-arrays-vlas.html#cb606-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> matrix<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb606-6"><a href="variable-length-arrays-vlas.html#cb606-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb606-7"><a href="variable-length-arrays-vlas.html#cb606-7" aria-hidden="true" tabindex="-1"></a>foo<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> matrix<span class="op">);</span>   <span class="co">// OK!</span></span></code></pre></div>
<p>Beware, though: if your dimensions mismatch, you’re going to have some undefined behavior going on, likely.</p>
<p></p>
<h2 data-number="30.7" id="typedef-and-vlas"><span class="header-section-number">30.7</span> <code>typedef</code> and VLAs</h2>
<p></p>
<p>You can <code>typedef</code> a VLA, but the behavior might not be as you expect.</p>
<p>Basically, <code>typedef</code> makes a new type with the values as they existed the moment the <code>typedef</code> was executed.</p>
<p>So it’s not a <code>typedef</code> of a VLA so much as a new fixed size array type of the dimensions at the time.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb607-1"><a href="variable-length-arrays-vlas.html#cb607-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb607-2"><a href="variable-length-arrays-vlas.html#cb607-2"></a></span>
<span id="cb607-3"><a href="variable-length-arrays-vlas.html#cb607-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb607-4"><a href="variable-length-arrays-vlas.html#cb607-4"></a><span class="op">{</span></span>
<span id="cb607-5"><a href="variable-length-arrays-vlas.html#cb607-5"></a>    <span class="dt">int</span> w <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb607-6"><a href="variable-length-arrays-vlas.html#cb607-6"></a></span>
<span id="cb607-7"><a href="variable-length-arrays-vlas.html#cb607-7"></a>    <span class="kw">typedef</span> <span class="dt">int</span> goat<span class="op">[</span>w<span class="op">];</span></span>
<span id="cb607-8"><a href="variable-length-arrays-vlas.html#cb607-8"></a></span>
<span id="cb607-9"><a href="variable-length-arrays-vlas.html#cb607-9"></a>    <span class="co">// goat is an array of 10 ints</span></span>
<span id="cb607-10"><a href="variable-length-arrays-vlas.html#cb607-10"></a>    goat x<span class="op">;</span></span>
<span id="cb607-11"><a href="variable-length-arrays-vlas.html#cb607-11"></a></span>
<span id="cb607-12"><a href="variable-length-arrays-vlas.html#cb607-12"></a>    <span class="co">// Init with squares of numbers</span></span>
<span id="cb607-13"><a href="variable-length-arrays-vlas.html#cb607-13"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> w<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb607-14"><a href="variable-length-arrays-vlas.html#cb607-14"></a>        x<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">*</span>i<span class="op">;</span></span>
<span id="cb607-15"><a href="variable-length-arrays-vlas.html#cb607-15"></a></span>
<span id="cb607-16"><a href="variable-length-arrays-vlas.html#cb607-16"></a>    <span class="co">// Print them</span></span>
<span id="cb607-17"><a href="variable-length-arrays-vlas.html#cb607-17"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> w<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb607-18"><a href="variable-length-arrays-vlas.html#cb607-18"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb607-19"><a href="variable-length-arrays-vlas.html#cb607-19"></a></span>
<span id="cb607-20"><a href="variable-length-arrays-vlas.html#cb607-20"></a>    <span class="co">// Now let&#39;s change w...</span></span>
<span id="cb607-21"><a href="variable-length-arrays-vlas.html#cb607-21"></a></span>
<span id="cb607-22"><a href="variable-length-arrays-vlas.html#cb607-22"></a>    w <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb607-23"><a href="variable-length-arrays-vlas.html#cb607-23"></a></span>
<span id="cb607-24"><a href="variable-length-arrays-vlas.html#cb607-24"></a>    <span class="co">// But goat is STILL an array of 10 ints, because that was the</span></span>
<span id="cb607-25"><a href="variable-length-arrays-vlas.html#cb607-25"></a>    <span class="co">// value of w when the typedef executed.</span></span>
<span id="cb607-26"><a href="variable-length-arrays-vlas.html#cb607-26"></a><span class="op">}</span></span></code></pre></div>
<p>So it acts like an array of fixed size.</p>
<p>But you still can’t use an initializer list on it.</p>
<p></p>
<h2 data-number="30.8" id="jumping-pitfalls"><span class="header-section-number">30.8</span> Jumping Pitfalls</h2>
<p></p>
<p>You have to watch out when using <code>goto</code> near VLAs because a lot of things aren’t legal.</p>
<p> </p>
<p>And when you’re using <code>longjmp()</code> there’s a case where you could leak memory with VLAs.</p>
<p></p>
<p>But both of these things we’ll cover in their respective chapters.</p>
<h2 data-number="30.9" id="vla-general-issues"><span class="header-section-number">30.9</span> General Issues</h2>
<p></p>
<p>VLAs have been banned from the Linux kernel for a few reasons:</p>
<ul>
<li>Lots of places they were used should have just been fixed-size.</li>
<li>The code behind VLAs is slower (to a degree that most people wouldn’t notice, but makes a difference in an operating system).</li>
<li>VLAs are not supported to the same degree by all C compilers.</li>
<li>Stack size is limited, and VLAs go on the stack. If some code accidentally (or maliciously) passes a large value into a kernel function that allocates a VLA, <em>Bad Things</em>™ could happen.</li>
</ul>
<p>Other folks online point out that there’s no way to detect a VLA’s failure to allocate, and programs that suffered such problems would likely just crash. While fixed-size arrays also have the same issue, it’s far more likely that someone accidentally make a <em>VLA Of Unusual Size</em> than somehow accidentally declare a fixed-size, say, 30 megabyte array.</p>
<p> </p>
<!-- BG_NEW_CHAPTER -->
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<hr><div style="text-align:center"><span><a href="signal-handling.html" rel="prev">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="goto.html" rel="next">Next</a></span></div></body>
</html>
