<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Beej's Guide to C Programming</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!-- BG custom styling -->
  <style type="text/css">
  /* Fix for line numbers not visible */
  pre.numberSource code > span {
      left: -1em;
  }
  pre.numberSource {
      margin-left: initial;
  }

  /* Put some space after the section numbers */
  span.toc-section-number::after {
      content: "\a0\a0\a0";  /* non-breaking whitespace */
  }

  /* Hide underlines on code number links */
  pre > code.sourceCode > span > a:first-child::before {
      text-decoration: none;
  }

  /* Color the source blocks */
  div.sourceCode {
      background-color: #f0f0f0;
  }

  /* Fix iOS big text rendering issue */
  pre > code.sourceCode > span {
      display: initial;
  }


  /* Color the inline code */
  code:not(.sourceCode) {
      background: #f0f0f0;
      padding-left: 0.2em;
      padding-right: 0.2em;
      border-radius: 0.2em;
  }

  pre.sourceCode {
      border: 1px solid #ccc;
      padding: 0.5em;
      border-radius: 0.2em;
  }

  /* Keep code tags from wrapping in tables */
  tbody code {
      white-space: nowrap;
  }

  /* Prevent hyphenation and hyphen breaks in code*/
  code {
      word-break: keep-all;
  }

  td {
      vertical-align: top;
  }

  body {
      font-size: 12pt;
      max-width: 43em;
      font-family: sans-serif;
  }

  html {
      background: #f9f9f9;
  }

  figure > embed {
      max-width: 100%;
  }

  figure {
      text-align: center;
      margin-top: 2em;
      margin-bottom: 2em;
  }

  figcaption {
      font-size: 0.9em;
      font-style: italic;
      margin-top: 0.6em;
  }

  body {
      counter-reset: figure-counter-major;
      counter-reset: figure-counter-minor;
  }

  figure {
      counter-increment: figure-counter-minor;
  }

  figcaption::before {
      content: "Figure " counter(figure-counter-major) "." counter(figure-counter-minor) ": ";
  }

  blockquote {
      border-left: 2px solid #bbb;
      color: #444;
  }

  /* Contents */

  nav[role="doc-toc"] > ul > li {
    font-weight: bold;
    margin-top: 1.2em;
  }

  nav[role="doc-toc"] > ul > li:first {
    font-weight: bold;
    margin-top: initial;
  }

  nav[role="doc-toc"] > ul > li > ul {
    font-weight: normal;
    margin-top: 0.3em;
  }

  /*
  In multipage, we need to reset the figure counter to the chapter
  number. Luckily, this is in the <h1 data-number> attribute. Unluckily,
  there is no way to get this in a general way.

  This doesn't work:

    h1[data-number] {
      counter-set: figure-counter-major attr(data-number);
    }

  Nor this:

    h1[data-number] {
      --figure-counter-major-value: attr(data-number);
      counter-set: figure-counter-major var(--figure-counter-major-value);
    }

  So, dumbly, we have a bunch of rules for all these sections, up to the
  maximum possible section.

  Here's a program to generate them:

    for (let i = 1; i < 100; i++)
        console.log(`h1[data-number="${i}"]{counter-set:figure-counter-major ${i};counter-reset:figure-counter-minor;}`);

  Note to self: never write a book with more than 99 frickin' chapters.
  */

  h1[data-number="1"]{counter-set:figure-counter-major 1;counter-reset:figure-counter-minor;}
  h1[data-number="2"]{counter-set:figure-counter-major 2;counter-reset:figure-counter-minor;}
  h1[data-number="3"]{counter-set:figure-counter-major 3;counter-reset:figure-counter-minor;}
  h1[data-number="4"]{counter-set:figure-counter-major 4;counter-reset:figure-counter-minor;}
  h1[data-number="5"]{counter-set:figure-counter-major 5;counter-reset:figure-counter-minor;}
  h1[data-number="6"]{counter-set:figure-counter-major 6;counter-reset:figure-counter-minor;}
  h1[data-number="7"]{counter-set:figure-counter-major 7;counter-reset:figure-counter-minor;}
  h1[data-number="8"]{counter-set:figure-counter-major 8;counter-reset:figure-counter-minor;}
  h1[data-number="9"]{counter-set:figure-counter-major 9;counter-reset:figure-counter-minor;}
  h1[data-number="10"]{counter-set:figure-counter-major 10;counter-reset:figure-counter-minor;}
  h1[data-number="11"]{counter-set:figure-counter-major 11;counter-reset:figure-counter-minor;}
  h1[data-number="12"]{counter-set:figure-counter-major 12;counter-reset:figure-counter-minor;}
  h1[data-number="13"]{counter-set:figure-counter-major 13;counter-reset:figure-counter-minor;}
  h1[data-number="14"]{counter-set:figure-counter-major 14;counter-reset:figure-counter-minor;}
  h1[data-number="15"]{counter-set:figure-counter-major 15;counter-reset:figure-counter-minor;}
  h1[data-number="16"]{counter-set:figure-counter-major 16;counter-reset:figure-counter-minor;}
  h1[data-number="17"]{counter-set:figure-counter-major 17;counter-reset:figure-counter-minor;}
  h1[data-number="18"]{counter-set:figure-counter-major 18;counter-reset:figure-counter-minor;}
  h1[data-number="19"]{counter-set:figure-counter-major 19;counter-reset:figure-counter-minor;}
  h1[data-number="20"]{counter-set:figure-counter-major 20;counter-reset:figure-counter-minor;}
  h1[data-number="21"]{counter-set:figure-counter-major 21;counter-reset:figure-counter-minor;}
  h1[data-number="22"]{counter-set:figure-counter-major 22;counter-reset:figure-counter-minor;}
  h1[data-number="23"]{counter-set:figure-counter-major 23;counter-reset:figure-counter-minor;}
  h1[data-number="24"]{counter-set:figure-counter-major 24;counter-reset:figure-counter-minor;}
  h1[data-number="25"]{counter-set:figure-counter-major 25;counter-reset:figure-counter-minor;}
  h1[data-number="26"]{counter-set:figure-counter-major 26;counter-reset:figure-counter-minor;}
  h1[data-number="27"]{counter-set:figure-counter-major 27;counter-reset:figure-counter-minor;}
  h1[data-number="28"]{counter-set:figure-counter-major 28;counter-reset:figure-counter-minor;}
  h1[data-number="29"]{counter-set:figure-counter-major 29;counter-reset:figure-counter-minor;}
  h1[data-number="30"]{counter-set:figure-counter-major 30;counter-reset:figure-counter-minor;}
  h1[data-number="31"]{counter-set:figure-counter-major 31;counter-reset:figure-counter-minor;}
  h1[data-number="32"]{counter-set:figure-counter-major 32;counter-reset:figure-counter-minor;}
  h1[data-number="33"]{counter-set:figure-counter-major 33;counter-reset:figure-counter-minor;}
  h1[data-number="34"]{counter-set:figure-counter-major 34;counter-reset:figure-counter-minor;}
  h1[data-number="35"]{counter-set:figure-counter-major 35;counter-reset:figure-counter-minor;}
  h1[data-number="36"]{counter-set:figure-counter-major 36;counter-reset:figure-counter-minor;}
  h1[data-number="37"]{counter-set:figure-counter-major 37;counter-reset:figure-counter-minor;}
  h1[data-number="38"]{counter-set:figure-counter-major 38;counter-reset:figure-counter-minor;}
  h1[data-number="39"]{counter-set:figure-counter-major 39;counter-reset:figure-counter-minor;}
  h1[data-number="40"]{counter-set:figure-counter-major 40;counter-reset:figure-counter-minor;}
  h1[data-number="41"]{counter-set:figure-counter-major 41;counter-reset:figure-counter-minor;}
  h1[data-number="42"]{counter-set:figure-counter-major 42;counter-reset:figure-counter-minor;}
  h1[data-number="43"]{counter-set:figure-counter-major 43;counter-reset:figure-counter-minor;}
  h1[data-number="44"]{counter-set:figure-counter-major 44;counter-reset:figure-counter-minor;}
  h1[data-number="45"]{counter-set:figure-counter-major 45;counter-reset:figure-counter-minor;}
  h1[data-number="46"]{counter-set:figure-counter-major 46;counter-reset:figure-counter-minor;}
  h1[data-number="47"]{counter-set:figure-counter-major 47;counter-reset:figure-counter-minor;}
  h1[data-number="48"]{counter-set:figure-counter-major 48;counter-reset:figure-counter-minor;}
  h1[data-number="49"]{counter-set:figure-counter-major 49;counter-reset:figure-counter-minor;}
  h1[data-number="50"]{counter-set:figure-counter-major 50;counter-reset:figure-counter-minor;}
  h1[data-number="51"]{counter-set:figure-counter-major 51;counter-reset:figure-counter-minor;}
  h1[data-number="52"]{counter-set:figure-counter-major 52;counter-reset:figure-counter-minor;}
  h1[data-number="53"]{counter-set:figure-counter-major 53;counter-reset:figure-counter-minor;}
  h1[data-number="54"]{counter-set:figure-counter-major 54;counter-reset:figure-counter-minor;}
  h1[data-number="55"]{counter-set:figure-counter-major 55;counter-reset:figure-counter-minor;}
  h1[data-number="56"]{counter-set:figure-counter-major 56;counter-reset:figure-counter-minor;}
  h1[data-number="57"]{counter-set:figure-counter-major 57;counter-reset:figure-counter-minor;}
  h1[data-number="58"]{counter-set:figure-counter-major 58;counter-reset:figure-counter-minor;}
  h1[data-number="59"]{counter-set:figure-counter-major 59;counter-reset:figure-counter-minor;}
  h1[data-number="60"]{counter-set:figure-counter-major 60;counter-reset:figure-counter-minor;}
  h1[data-number="61"]{counter-set:figure-counter-major 61;counter-reset:figure-counter-minor;}
  h1[data-number="62"]{counter-set:figure-counter-major 62;counter-reset:figure-counter-minor;}
  h1[data-number="63"]{counter-set:figure-counter-major 63;counter-reset:figure-counter-minor;}
  h1[data-number="64"]{counter-set:figure-counter-major 64;counter-reset:figure-counter-minor;}
  h1[data-number="65"]{counter-set:figure-counter-major 65;counter-reset:figure-counter-minor;}
  h1[data-number="66"]{counter-set:figure-counter-major 66;counter-reset:figure-counter-minor;}
  h1[data-number="67"]{counter-set:figure-counter-major 67;counter-reset:figure-counter-minor;}
  h1[data-number="68"]{counter-set:figure-counter-major 68;counter-reset:figure-counter-minor;}
  h1[data-number="69"]{counter-set:figure-counter-major 69;counter-reset:figure-counter-minor;}
  h1[data-number="70"]{counter-set:figure-counter-major 70;counter-reset:figure-counter-minor;}
  h1[data-number="71"]{counter-set:figure-counter-major 71;counter-reset:figure-counter-minor;}
  h1[data-number="72"]{counter-set:figure-counter-major 72;counter-reset:figure-counter-minor;}
  h1[data-number="73"]{counter-set:figure-counter-major 73;counter-reset:figure-counter-minor;}
  h1[data-number="74"]{counter-set:figure-counter-major 74;counter-reset:figure-counter-minor;}
  h1[data-number="75"]{counter-set:figure-counter-major 75;counter-reset:figure-counter-minor;}
  h1[data-number="76"]{counter-set:figure-counter-major 76;counter-reset:figure-counter-minor;}
  h1[data-number="77"]{counter-set:figure-counter-major 77;counter-reset:figure-counter-minor;}
  h1[data-number="78"]{counter-set:figure-counter-major 78;counter-reset:figure-counter-minor;}
  h1[data-number="79"]{counter-set:figure-counter-major 79;counter-reset:figure-counter-minor;}
  h1[data-number="80"]{counter-set:figure-counter-major 80;counter-reset:figure-counter-minor;}
  h1[data-number="81"]{counter-set:figure-counter-major 81;counter-reset:figure-counter-minor;}
  h1[data-number="82"]{counter-set:figure-counter-major 82;counter-reset:figure-counter-minor;}
  h1[data-number="83"]{counter-set:figure-counter-major 83;counter-reset:figure-counter-minor;}
  h1[data-number="84"]{counter-set:figure-counter-major 84;counter-reset:figure-counter-minor;}
  h1[data-number="85"]{counter-set:figure-counter-major 85;counter-reset:figure-counter-minor;}
  h1[data-number="86"]{counter-set:figure-counter-major 86;counter-reset:figure-counter-minor;}
  h1[data-number="87"]{counter-set:figure-counter-major 87;counter-reset:figure-counter-minor;}
  h1[data-number="88"]{counter-set:figure-counter-major 88;counter-reset:figure-counter-minor;}
  h1[data-number="89"]{counter-set:figure-counter-major 89;counter-reset:figure-counter-minor;}
  h1[data-number="90"]{counter-set:figure-counter-major 90;counter-reset:figure-counter-minor;}
  h1[data-number="91"]{counter-set:figure-counter-major 91;counter-reset:figure-counter-minor;}
  h1[data-number="92"]{counter-set:figure-counter-major 92;counter-reset:figure-counter-minor;}
  h1[data-number="93"]{counter-set:figure-counter-major 93;counter-reset:figure-counter-minor;}
  h1[data-number="94"]{counter-set:figure-counter-major 94;counter-reset:figure-counter-minor;}
  h1[data-number="95"]{counter-set:figure-counter-major 95;counter-reset:figure-counter-minor;}
  h1[data-number="96"]{counter-set:figure-counter-major 96;counter-reset:figure-counter-minor;}
  h1[data-number="97"]{counter-set:figure-counter-major 97;counter-reset:figure-counter-minor;}
  h1[data-number="98"]{counter-set:figure-counter-major 98;counter-reset:figure-counter-minor;}
  h1[data-number="99"]{counter-set:figure-counter-major 99;counter-reset:figure-counter-minor;}


  </style>
  <!-- BG custom styling for the wide body variant -->
  <!-- Gets appended after bg-css.html -->

  <style type="text/css">
  body {
      max-width: inherit;
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>
<div style="text-align:center"><span><a href="stdarg.html" rel="prev">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="stdbit.html" rel="next">Next</a></span></div><hr>
<h1 data-number="18" id="stdatomic"><span class="header-section-number">18</span> <code>&lt;stdatomic.h&gt;</code> Atomic-Related Functions</h1>
<p></p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong_explicit()</code></a></td>
<td>Atomic compare and exchange, strong, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong()</code></a></td>
<td>Atomic compare and exchange, strong</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak_explicit()</code></a></td>
<td>Atomic compare and exchange, weak, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak()</code></a></td>
<td>Atomic compare and exchange, weak</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange_explicit()</code></a></td>
<td>Replace a value in an atomic object, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange()</code></a></td>
<td>Replace a value in an atomic object</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_add_explicit()</code></a></td>
<td>Atomically add to an atomic integer, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_add()</code></a></td>
<td>Atomically add to an atomic integer</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_and_explicit()</code></a></td>
<td>Atomically bitwise-AND an atomic integer, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_and()</code></a></td>
<td>Atomically bitwise-AND an atomic integer</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_or_explicit()</code></a></td>
<td>Atomically bitwise-OR an atomic integer, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_or()</code></a></td>
<td>Atomically bitwise-OR an atomic integer</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_sub_explicit()</code></a></td>
<td>Atomically subtract from an atomic integer, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_sub()</code></a></td>
<td>Atomically subtract from an atomic integer</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_xor_explicit()</code></a></td>
<td>Atomically bitwise-XOR an atomic integer, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_xor()</code></a></td>
<td>Atomically bitwise-XOR an atomic integer</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_flag_clear"><code>atomic_flag_clear_explicit()</code></a></td>
<td>Clear an atomic flag, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_flag_clear"><code>atomic_flag_clear()</code></a></td>
<td>Clear an atomic flag</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_flag_test_and_set"><code>atomic_flag_test_and_set_explicit()</code></a></td>
<td>Test and set an atomic flag, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_flag_test_and_set"><code>atomic_flag_test_and_set()</code></a></td>
<td>Test and set an atomic flag</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_init"><code>atomic_init()</code></a></td>
<td>Initialize an atomic variable</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_is_lock_free"><code>atomic_is_lock_free()</code></a></td>
<td>Determine if an atomic type is lock free</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_load"><code>atomic_load_explicit()</code></a></td>
<td>Return a value from an atomic variable, explicit</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_load"><code>atomic_load()</code></a></td>
<td>Return a value from an atomic variable</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_signal_fence"><code>atomic_signal_fence()</code></a></td>
<td>Fence for intra-thread signal handlers</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a></td>
<td>Store a value in an atomic variable, explicit</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-atomic_store"><code>atomic_store()</code></a></td>
<td>Store a value in an atomic variable</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-atomic_thread_fence"><code>atomic_thread_fence()</code></a></td>
<td>Set up a fence</td>
</tr>
<tr class="odd">
<td><a href="stdatomic.html#man-ATOMIC_VAR_INIT"><code>ATOMIC_VAR_INIT()</code></a></td>
<td>Create an initializer for an atomic variable</td>
</tr>
<tr class="even">
<td><a href="stdatomic.html#man-kill_dependency"><code>kill_dependency()</code></a></td>
<td>End a dependency chain</td>
</tr>
</tbody>
</table>
<p>You might need to add <code>-latomic</code> to your compilation command line on Unix-like operating systems.</p>
<h2 data-number="18.1" id="atomic-types"><span class="header-section-number">18.1</span> Atomic Types</h2>
<p>A bunch of types are predefined by this header:</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th>Atomic type</th>
<th>Longhand equivalent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>atomic_bool</code></td>
<td><code>_Atomic _Bool</code></td>
</tr>
<tr class="even">
<td><code>atomic_char</code></td>
<td><code>_Atomic char</code></td>
</tr>
<tr class="odd">
<td><code>atomic_schar</code></td>
<td><code>_Atomic signed char</code></td>
</tr>
<tr class="even">
<td><code>atomic_uchar</code></td>
<td><code>_Atomic unsigned char</code></td>
</tr>
<tr class="odd">
<td><code>atomic_short</code></td>
<td><code>_Atomic short</code></td>
</tr>
<tr class="even">
<td><code>atomic_ushort</code></td>
<td><code>_Atomic unsigned short</code></td>
</tr>
<tr class="odd">
<td><code>atomic_int</code></td>
<td><code>_Atomic int</code></td>
</tr>
<tr class="even">
<td><code>atomic_uint</code></td>
<td><code>_Atomic unsigned int</code></td>
</tr>
<tr class="odd">
<td><code>atomic_long</code></td>
<td><code>_Atomic long</code></td>
</tr>
<tr class="even">
<td><code>atomic_ulong</code></td>
<td><code>_Atomic unsigned long</code></td>
</tr>
<tr class="odd">
<td><code>atomic_llong</code></td>
<td><code>_Atomic long long</code></td>
</tr>
<tr class="even">
<td><code>atomic_ullong</code></td>
<td><code>_Atomic unsigned long long</code></td>
</tr>
<tr class="odd">
<td><code>atomic_char16_t</code></td>
<td><code>_Atomic char16_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_char32_t</code></td>
<td><code>_Atomic char32_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_wchar_t</code></td>
<td><code>_Atomic wchar_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least8_t</code></td>
<td><code>_Atomic int_least8_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least8_t</code></td>
<td><code>_Atomic uint_least8_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least16_t</code></td>
<td><code>_Atomic int_least16_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least16_t</code></td>
<td><code>_Atomic uint_least16_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least32_t</code></td>
<td><code>_Atomic int_least32_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least32_t</code></td>
<td><code>_Atomic uint_least32_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least64_t</code></td>
<td><code>_Atomic int_least64_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least64_t</code></td>
<td><code>_Atomic uint_least64_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast8_t</code></td>
<td><code>_Atomic int_fast8_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast8_t</code></td>
<td><code>_Atomic uint_fast8_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast16_t</code></td>
<td><code>_Atomic int_fast16_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast16_t</code></td>
<td><code>_Atomic uint_fast16_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast32_t</code></td>
<td><code>_Atomic int_fast32_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast32_t</code></td>
<td><code>_Atomic uint_fast32_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast64_t</code></td>
<td><code>_Atomic int_fast64_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast64_t</code></td>
<td><code>_Atomic uint_fast64_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_intptr_t</code></td>
<td><code>_Atomic intptr_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uintptr_t</code></td>
<td><code>_Atomic uintptr_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_size_t</code></td>
<td><code>_Atomic size_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_ptrdiff_t</code></td>
<td><code>_Atomic ptrdiff_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_intmax_t</code></td>
<td><code>_Atomic intmax_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uintmax_t</code></td>
<td><code>_Atomic uintmax_t</code></td>
</tr>
</tbody>
</table>
<p>You can make your own additional types with the <code>_Atomic</code> type qualifier:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb435-1"><a href="stdatomic.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">double</span> x<span class="op">;</span></span></code></pre></div>
<p>or the <code>_Atomic()</code> type specifier:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb436-1"><a href="stdatomic.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span><span class="op">(</span><span class="dt">double</span><span class="op">)</span> x<span class="op">;</span></span></code></pre></div>
<h2 data-number="18.2" id="lock-free-macros"><span class="header-section-number">18.2</span> Lock-free Macros</h2>
<p>These macros let you know if a type is lock-free or not. Maybe.</p>
<p>They can be used at compile time with <code>#if</code>. They apply to both signed and unsigned types.</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th>Atomic Type</th>
<th>Lock Free Macro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>atomic_bool</code></td>
<td><code>ATOMIC_BOOL_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_char</code></td>
<td><code>ATOMIC_CHAR_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_char16_t</code></td>
<td><code>ATOMIC_CHAR16_T_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_char32_t</code></td>
<td><code>ATOMIC_CHAR32_T_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_wchar_t</code></td>
<td><code>ATOMIC_WCHAR_T_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_short</code></td>
<td><code>ATOMIC_SHORT_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_int</code></td>
<td><code>ATOMIC_INT_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_long</code></td>
<td><code>ATOMIC_LONG_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_llong</code></td>
<td><code>ATOMIC_LLONG_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_intptr_t</code></td>
<td><code>ATOMIC_POINTER_LOCK_FREE</code></td>
</tr>
</tbody>
</table>
<p>These macros can interestingly have <em>three</em> different values:</p>
<table>
<thead>
<tr class="header">
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0</code></td>
<td>Never lock-free.</td>
</tr>
<tr class="even">
<td><code>1</code></td>
<td><em>Sometimes</em> lock-free<a href="wctype.html#fn38" class="footnote-ref" id="fnref38" role="doc-noteref"><sup>38</sup></a>.</td>
</tr>
<tr class="odd">
<td><code>2</code></td>
<td>Always lock-free.</td>
</tr>
</tbody>
</table>
<h2 data-number="18.3" id="atomic-flag"><span class="header-section-number">18.3</span> Atomic Flag</h2>
<p>The <code>atomic_flag</code> opaque type is the only time guaranteed to be lock-free. Though your PC implementation probably does a lot more.</p>
<p>It is accessed through the <a href="stdatomic.html#man-atomic_flag_test_and_set"><code>atomic_flag_test_and_set()</code></a> and <a href="stdatomic.html#man-atomic_flag_clear"><code>atomic_flag_clear()</code></a> functions.</p>
<p>Before use, it can be initialized to a clear state with:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb437-1"><a href="stdatomic.html#cb437-1" aria-hidden="true" tabindex="-1"></a>atomic_flag f <span class="op">=</span> ATOMIC_FLAG_INIT<span class="op">;</span></span></code></pre></div>
<h2 data-number="18.4" id="memory-order"><span class="header-section-number">18.4</span> Memory Order</h2>
<p>This header introduces a new <code>enum</code> type called <code>memory_order</code>. This is used by a bunch of the functions to specify memory orders other than sequential consistency.</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th><code>memory_order</code></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>memory_order_seq_cst</code></td>
<td>Sequential Consistency</td>
</tr>
<tr class="even">
<td><code>memory_order_acq_rel</code></td>
<td>Acquire/Release</td>
</tr>
<tr class="odd">
<td><code>memory_order_release</code></td>
<td>Release</td>
</tr>
<tr class="even">
<td><code>memory_order_acquire</code></td>
<td>Acquire</td>
</tr>
<tr class="odd">
<td><code>memory_order_consume</code></td>
<td>Consume</td>
</tr>
<tr class="even">
<td><code>memory_order_relaxed</code></td>
<td>Relaxed</td>
</tr>
</tbody>
</table>
<p>You can feed these into atomic functions with the <code>_explicit</code> suffix.</p>
<p>The non-<code>_explcit</code> versions of the functions are the same as if you’d called the <code>_explicit</code> counterpart with <code>memory_order_seq_cst</code>.</p>
<hr />
<h2 data-number="18.5" id="man-ATOMIC_VAR_INIT"><span class="header-section-number">18.5</span> <code>ATOMIC_VAR_INIT()</code></h2>
<p></p>
<p>Create an initializer for an atomic variable</p>
<h3 class="unnumbered unlisted" id="synopsis-122">Synopsis</h3>
<div class="sourceCode" id="cb438"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb438-1"><a href="stdatomic.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb438-2"><a href="stdatomic.html#cb438-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-3"><a href="stdatomic.html#cb438-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ATOMIC_VAR_INIT</span><span class="op">(</span><span class="pp">C value</span><span class="op">)</span><span class="pp">   </span><span class="co">// Deprecated</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-122">Description</h3>
<p>This macro expands to an initializer, so you can use it when a variable is defined.</p>
<p>The type of the <code>value</code> should be the base type of the atomic variable.</p>
<p>The initialization itself is <em>not</em> an atomic operation, ironically.</p>
<p><a href="https://en.cppreference.com/w/cpp/atomic/ATOMIC_VAR_INIT">CPPReference says this is deprecated</a><a href="wctype.html#fn39" class="footnote-ref" id="fnref39" role="doc-noteref"><sup>39</sup></a> and likely to be removed. Standards document <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/p1138r0.pdf">p1138r0</a><a href="wctype.html#fn40" class="footnote-ref" id="fnref40" role="doc-noteref"><sup>40</sup></a> elaborates that the macro is limited in that it can’t properly initialize atomic <code>struct</code>s, and its original <em>raison d’être</em> turned out to not be useful.</p>
<p>Just initialize the variable straight-up, instead.</p>
<h3 class="unnumbered unlisted" id="return-value-120">Return Value</h3>
<p>Expands to an initializer suitable for this atomic variable.</p>
<h3 class="unnumbered unlisted" id="example-122">Example</h3>
<div class="sourceCode" id="cb439"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb439-1"><a href="stdatomic.html#cb439-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb439-2"><a href="stdatomic.html#cb439-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb439-3"><a href="stdatomic.html#cb439-3"></a></span>
<span id="cb439-4"><a href="stdatomic.html#cb439-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb439-5"><a href="stdatomic.html#cb439-5"></a><span class="op">{</span></span>
<span id="cb439-6"><a href="stdatomic.html#cb439-6"></a>    atomic_int x <span class="op">=</span> ATOMIC_VAR_INIT<span class="op">(</span><span class="dv">3490</span><span class="op">);</span>  <span class="co">// Deprecated</span></span>
<span id="cb439-7"><a href="stdatomic.html#cb439-7"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb439-8"><a href="stdatomic.html#cb439-8"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-115">See Also</h3>
<p><a href="stdatomic.html#man-atomic_init"><code>atomic_init()</code></a></p>
<hr />
<h2 data-number="18.6" id="man-atomic_init"><span class="header-section-number">18.6</span> <code>atomic_init()</code></h2>
<p></p>
<p>Initialize an atomic variable</p>
<h3 class="unnumbered unlisted" id="synopsis-123">Synopsis</h3>
<div class="sourceCode" id="cb440"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb440-1"><a href="stdatomic.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb440-2"><a href="stdatomic.html#cb440-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-3"><a href="stdatomic.html#cb440-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_init<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>obj<span class="op">,</span> C value<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-123">Description</h3>
<p>You can use this to initialize an atomic variable.</p>
<p>The type of the <code>value</code> should be the base type of the atomic variable.</p>
<p>The initialization itself is <em>not</em> an atomic operation, ironically.</p>
<p>As far as I can tell, there’s no difference between this and assigning directly to the atomic variable. The spec says it’s there to allow the compiler to inject any additional initialization that needs doing, but everything seems fine without it. If anyone has more info, send it my way.</p>
<h3 class="unnumbered unlisted" id="return-value-121">Return Value</h3>
<p>Returns nothing!</p>
<h3 class="unnumbered unlisted" id="example-123">Example</h3>
<div class="sourceCode" id="cb441"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb441-1"><a href="stdatomic.html#cb441-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb441-2"><a href="stdatomic.html#cb441-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb441-3"><a href="stdatomic.html#cb441-3"></a></span>
<span id="cb441-4"><a href="stdatomic.html#cb441-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb441-5"><a href="stdatomic.html#cb441-5"></a><span class="op">{</span></span>
<span id="cb441-6"><a href="stdatomic.html#cb441-6"></a>    atomic_int x<span class="op">;</span></span>
<span id="cb441-7"><a href="stdatomic.html#cb441-7"></a>    </span>
<span id="cb441-8"><a href="stdatomic.html#cb441-8"></a>    atomic_init<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">3490</span><span class="op">);</span></span>
<span id="cb441-9"><a href="stdatomic.html#cb441-9"></a></span>
<span id="cb441-10"><a href="stdatomic.html#cb441-10"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb441-11"><a href="stdatomic.html#cb441-11"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-116">See Also</h3>
<p><a href="stdatomic.html#man-ATOMIC_VAR_INIT"><code>ATOMIC_VAR_INIT()</code></a>, <a href="stdatomic.html#man-atomic_store"><code>atomic_store()</code></a>, <a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a></p>
<hr />
<h2 data-number="18.7" id="man-kill_dependency"><span class="header-section-number">18.7</span> <code>kill_dependency()</code></h2>
<p></p>
<p>End a dependency chain</p>
<h3 class="unnumbered unlisted" id="synopsis-124">Synopsis</h3>
<div class="sourceCode" id="cb442"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb442-1"><a href="stdatomic.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb442-2"><a href="stdatomic.html#cb442-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-3"><a href="stdatomic.html#cb442-3" aria-hidden="true" tabindex="-1"></a>type kill_dependency<span class="op">(</span>type y<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-124">Description</h3>
<p>This is potentially useful for optimizing if you’re using <code>memory_order_consume</code> anywhere.</p>
<p>And if you know what you’re doing. If unsure, learn more before trying to use this.</p>
<h3 class="unnumbered unlisted" id="return-value-122">Return Value</h3>
<p>Returns the value passed in.</p>
<h3 class="unnumbered unlisted" id="example-124">Example</h3>
<p>In this example, <code>i</code> carries a dependency into <code>x</code>. And would do into <code>y</code>, except for the call to <code>kill_dependency()</code>.</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb443-1"><a href="stdatomic.html#cb443-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb443-2"><a href="stdatomic.html#cb443-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb443-3"><a href="stdatomic.html#cb443-3"></a></span>
<span id="cb443-4"><a href="stdatomic.html#cb443-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb443-5"><a href="stdatomic.html#cb443-5"></a><span class="op">{</span></span>
<span id="cb443-6"><a href="stdatomic.html#cb443-6"></a>    atomic_int a<span class="op">;</span></span>
<span id="cb443-7"><a href="stdatomic.html#cb443-7"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb443-8"><a href="stdatomic.html#cb443-8"></a></span>
<span id="cb443-9"><a href="stdatomic.html#cb443-9"></a>    atomic_store_explicit<span class="op">(&amp;</span>a<span class="op">,</span> <span class="dv">3490</span><span class="op">,</span> memory_order_release<span class="op">);</span></span>
<span id="cb443-10"><a href="stdatomic.html#cb443-10"></a></span>
<span id="cb443-11"><a href="stdatomic.html#cb443-11"></a>    i <span class="op">=</span> atomic_load_explicit<span class="op">(&amp;</span>a<span class="op">,</span> memory_order_consume<span class="op">);</span></span>
<span id="cb443-12"><a href="stdatomic.html#cb443-12"></a>    x <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb443-13"><a href="stdatomic.html#cb443-13"></a>    y <span class="op">=</span> kill_dependency<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb443-14"><a href="stdatomic.html#cb443-14"></a></span>
<span id="cb443-15"><a href="stdatomic.html#cb443-15"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">);</span>  <span class="co">// 3490 and either 3490 or 10</span></span>
<span id="cb443-16"><a href="stdatomic.html#cb443-16"></a><span class="op">}</span></span></code></pre></div>
<!--
### See Also {.unnumbered .unlisted}

[`example()`](#man-example),
-->
<hr />
<h2 data-number="18.8" id="man-atomic_thread_fence"><span class="header-section-number">18.8</span> <code>atomic_thread_fence()</code></h2>
<p></p>
<p>Set up a fence</p>
<h3 class="unnumbered unlisted" id="synopsis-125">Synopsis</h3>
<div class="sourceCode" id="cb444"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb444-1"><a href="stdatomic.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb444-2"><a href="stdatomic.html#cb444-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-3"><a href="stdatomic.html#cb444-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_thread_fence<span class="op">(</span>memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-125">Description</h3>
<p>This sets up a memory fence with the specified <code>order</code>.</p>
<table>
<thead>
<tr class="header">
<th><code>order</code></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>memory_order_seq_cst</code></td>
<td>Sequentially consistency acquire/release fence</td>
</tr>
<tr class="even">
<td><code>memory_order_acq_rel</code></td>
<td>Acquire/release dence</td>
</tr>
<tr class="odd">
<td><code>memory_order_release</code></td>
<td>Release fence</td>
</tr>
<tr class="even">
<td><code>memory_order_acquire</code></td>
<td>Acquire fence</td>
</tr>
<tr class="odd">
<td><code>memory_order_consume</code></td>
<td>Acquire fence (again)</td>
</tr>
<tr class="even">
<td><code>memory_order_relaxed</code></td>
<td>No fence at all—no point in calling with this</td>
</tr>
</tbody>
</table>
<p>You might try to avoid using these and just stick with the different modes with <a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a> and <a href="stdatomic.html#man-atomic_load"><code>atomic_load_explicit()</code></a>. Or not.</p>
<h3 class="unnumbered unlisted" id="return-value-123">Return Value</h3>
<p>Returns nothing!</p>
<h3 class="unnumbered unlisted" id="example-125">Example</h3>
<div class="sourceCode" id="cb445"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb445-1"><a href="stdatomic.html#cb445-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb445-2"><a href="stdatomic.html#cb445-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb445-3"><a href="stdatomic.html#cb445-3"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb445-4"><a href="stdatomic.html#cb445-4"></a></span>
<span id="cb445-5"><a href="stdatomic.html#cb445-5"></a>atomic_int shared_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb445-6"><a href="stdatomic.html#cb445-6"></a>atomic_int shared_2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb445-7"><a href="stdatomic.html#cb445-7"></a></span>
<span id="cb445-8"><a href="stdatomic.html#cb445-8"></a><span class="dt">int</span> thread_1<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb445-9"><a href="stdatomic.html#cb445-9"></a><span class="op">{</span></span>
<span id="cb445-10"><a href="stdatomic.html#cb445-10"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb445-11"><a href="stdatomic.html#cb445-11"></a></span>
<span id="cb445-12"><a href="stdatomic.html#cb445-12"></a>    atomic_store_explicit<span class="op">(&amp;</span>shared_1<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> memory_order_relaxed<span class="op">);</span></span>
<span id="cb445-13"><a href="stdatomic.html#cb445-13"></a></span>
<span id="cb445-14"><a href="stdatomic.html#cb445-14"></a>    atomic_thread_fence<span class="op">(</span>memory_order_release<span class="op">);</span></span>
<span id="cb445-15"><a href="stdatomic.html#cb445-15"></a></span>
<span id="cb445-16"><a href="stdatomic.html#cb445-16"></a>    atomic_store_explicit<span class="op">(&amp;</span>shared_2<span class="op">,</span> <span class="dv">20</span><span class="op">,</span> memory_order_relaxed<span class="op">);</span></span>
<span id="cb445-17"><a href="stdatomic.html#cb445-17"></a></span>
<span id="cb445-18"><a href="stdatomic.html#cb445-18"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb445-19"><a href="stdatomic.html#cb445-19"></a><span class="op">}</span></span>
<span id="cb445-20"><a href="stdatomic.html#cb445-20"></a></span>
<span id="cb445-21"><a href="stdatomic.html#cb445-21"></a><span class="dt">int</span> thread_2<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb445-22"><a href="stdatomic.html#cb445-22"></a><span class="op">{</span></span>
<span id="cb445-23"><a href="stdatomic.html#cb445-23"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb445-24"><a href="stdatomic.html#cb445-24"></a></span>
<span id="cb445-25"><a href="stdatomic.html#cb445-25"></a>    <span class="co">// If this fence runs after the release fence, we&#39;re</span></span>
<span id="cb445-26"><a href="stdatomic.html#cb445-26"></a>    <span class="co">// guaranteed to see thread_1&#39;s changes to the shared</span></span>
<span id="cb445-27"><a href="stdatomic.html#cb445-27"></a>    <span class="co">// varaibles.</span></span>
<span id="cb445-28"><a href="stdatomic.html#cb445-28"></a></span>
<span id="cb445-29"><a href="stdatomic.html#cb445-29"></a>    atomic_thread_fence<span class="op">(</span>memory_order_acquire<span class="op">);</span></span>
<span id="cb445-30"><a href="stdatomic.html#cb445-30"></a></span>
<span id="cb445-31"><a href="stdatomic.html#cb445-31"></a>    <span class="cf">if</span> <span class="op">(</span>shared_2 <span class="op">==</span> <span class="dv">20</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb445-32"><a href="stdatomic.html#cb445-32"></a>        printf<span class="op">(</span><span class="st">&quot;Shared_1 better be 10 and it&#39;s </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> shared_1<span class="op">);</span></span>
<span id="cb445-33"><a href="stdatomic.html#cb445-33"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb445-34"><a href="stdatomic.html#cb445-34"></a>        printf<span class="op">(</span><span class="st">&quot;Anything&#39;s possible: </span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> shared_1<span class="op">,</span> shared_2<span class="op">);</span></span>
<span id="cb445-35"><a href="stdatomic.html#cb445-35"></a>    <span class="op">}</span></span>
<span id="cb445-36"><a href="stdatomic.html#cb445-36"></a></span>
<span id="cb445-37"><a href="stdatomic.html#cb445-37"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb445-38"><a href="stdatomic.html#cb445-38"></a><span class="op">}</span></span>
<span id="cb445-39"><a href="stdatomic.html#cb445-39"></a></span>
<span id="cb445-40"><a href="stdatomic.html#cb445-40"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb445-41"><a href="stdatomic.html#cb445-41"></a><span class="op">{</span></span>
<span id="cb445-42"><a href="stdatomic.html#cb445-42"></a>    thrd_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb445-43"><a href="stdatomic.html#cb445-43"></a></span>
<span id="cb445-44"><a href="stdatomic.html#cb445-44"></a>    thrd_create<span class="op">(&amp;</span>t2<span class="op">,</span> thread_2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb445-45"><a href="stdatomic.html#cb445-45"></a>    thrd_create<span class="op">(&amp;</span>t1<span class="op">,</span> thread_1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb445-46"><a href="stdatomic.html#cb445-46"></a></span>
<span id="cb445-47"><a href="stdatomic.html#cb445-47"></a>    thrd_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb445-48"><a href="stdatomic.html#cb445-48"></a>    thrd_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb445-49"><a href="stdatomic.html#cb445-49"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-117">See Also</h3>
<p><a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a>, <a href="stdatomic.html#man-atomic_load"><code>atomic_load_explicit()</code></a>, <a href="stdatomic.html#man-atomic_signal_fence"><code>atomic_signal_fence()</code></a></p>
<hr />
<h2 data-number="18.9" id="man-atomic_signal_fence"><span class="header-section-number">18.9</span> <code>atomic_signal_fence()</code></h2>
<p></p>
<p>Fence for intra-thread signal handlers</p>
<h3 class="unnumbered unlisted" id="synopsis-126">Synopsis</h3>
<div class="sourceCode" id="cb446"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb446-1"><a href="stdatomic.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb446-2"><a href="stdatomic.html#cb446-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-3"><a href="stdatomic.html#cb446-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_signal_fence<span class="op">(</span>memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-126">Description</h3>
<p>This works like <code>atomic_thread_fence()</code> except its purpose is within in a single thread; notably for use in a signal handler in that thread.</p>
<p>Since signals can happen at any time, we might need a way to be certain that any writes by the thread that happened before the signal handler be visible within that signal handler.</p>
<h3 class="unnumbered unlisted" id="return-value-124">Return Value</h3>
<p>Returns nothing!</p>
<h3 class="unnumbered unlisted" id="example-126">Example</h3>
<p>Partial demo. (Note that it’s technically undefined behavior to call <code>printf()</code> in a signal handler.)</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb447-1"><a href="stdatomic.html#cb447-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb447-2"><a href="stdatomic.html#cb447-2"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb447-3"><a href="stdatomic.html#cb447-3"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb447-4"><a href="stdatomic.html#cb447-4"></a></span>
<span id="cb447-5"><a href="stdatomic.html#cb447-5"></a><span class="dt">int</span> global<span class="op">;</span></span>
<span id="cb447-6"><a href="stdatomic.html#cb447-6"></a></span>
<span id="cb447-7"><a href="stdatomic.html#cb447-7"></a><span class="dt">void</span> handler<span class="op">(</span><span class="dt">int</span> sig<span class="op">)</span></span>
<span id="cb447-8"><a href="stdatomic.html#cb447-8"></a><span class="op">{</span></span>
<span id="cb447-9"><a href="stdatomic.html#cb447-9"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>sig<span class="op">;</span></span>
<span id="cb447-10"><a href="stdatomic.html#cb447-10"></a></span>
<span id="cb447-11"><a href="stdatomic.html#cb447-11"></a>    <span class="co">// If this runs before the release, the handler will</span></span>
<span id="cb447-12"><a href="stdatomic.html#cb447-12"></a>    <span class="co">// potentially see global == 0.</span></span>
<span id="cb447-13"><a href="stdatomic.html#cb447-13"></a>    <span class="co">//</span></span>
<span id="cb447-14"><a href="stdatomic.html#cb447-14"></a>    <span class="co">// Otherwise, it will definitely see global == 10.</span></span>
<span id="cb447-15"><a href="stdatomic.html#cb447-15"></a></span>
<span id="cb447-16"><a href="stdatomic.html#cb447-16"></a>    atomic_signal_fence<span class="op">(</span>memory_order_acquire<span class="op">);</span></span>
<span id="cb447-17"><a href="stdatomic.html#cb447-17"></a></span>
<span id="cb447-18"><a href="stdatomic.html#cb447-18"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> global<span class="op">);</span></span>
<span id="cb447-19"><a href="stdatomic.html#cb447-19"></a><span class="op">}</span></span>
<span id="cb447-20"><a href="stdatomic.html#cb447-20"></a></span>
<span id="cb447-21"><a href="stdatomic.html#cb447-21"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb447-22"><a href="stdatomic.html#cb447-22"></a><span class="op">{</span></span>
<span id="cb447-23"><a href="stdatomic.html#cb447-23"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> handler<span class="op">);</span></span>
<span id="cb447-24"><a href="stdatomic.html#cb447-24"></a></span>
<span id="cb447-25"><a href="stdatomic.html#cb447-25"></a>    global <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb447-26"><a href="stdatomic.html#cb447-26"></a></span>
<span id="cb447-27"><a href="stdatomic.html#cb447-27"></a>    atomic_signal_fence<span class="op">(</span>memory_order_release<span class="op">);</span></span>
<span id="cb447-28"><a href="stdatomic.html#cb447-28"></a></span>
<span id="cb447-29"><a href="stdatomic.html#cb447-29"></a>    <span class="co">// If the signal handler runs after the release</span></span>
<span id="cb447-30"><a href="stdatomic.html#cb447-30"></a>    <span class="co">// it will definitely see the value 10 in global.</span></span>
<span id="cb447-31"><a href="stdatomic.html#cb447-31"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-118">See Also</h3>
<p><a href="stdatomic.html#man-atomic_thread_fence"><code>atomic_thread_fence()</code></a>, <a href="signal.html#man-signal"><code>signal()</code></a></p>
<hr />
<h2 data-number="18.10" id="man-atomic_is_lock_free"><span class="header-section-number">18.10</span> <code>atomic_is_lock_free()</code></h2>
<p></p>
<p>Determine if an atomic type is lock free</p>
<h3 class="unnumbered unlisted" id="synopsis-127">Synopsis</h3>
<div class="sourceCode" id="cb448"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb448-1"><a href="stdatomic.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb448-2"><a href="stdatomic.html#cb448-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-3"><a href="stdatomic.html#cb448-3" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_is_lock_free<span class="op">(</span><span class="dt">const</span> <span class="dt">volatile</span> A <span class="op">*</span>obj<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-127">Description</h3>
<p>Determines if the variable <code>obj</code> of type <code>A</code> is lock-free. Can be used with any type.</p>
<p>Unlike the <a href="stdatomic.html#lock-free-macros">lock-free macros</a> which can be used at compile-time, this is strictly a run-time function. So in places where the macros say “maybe”, this function will definitely tell you one way or another if the atomic variable is lock-free.</p>
<p>This is useful when you’re defining your own atomic variables and want to know their lock-free status.</p>
<h3 class="unnumbered unlisted" id="return-value-125">Return Value</h3>
<p>True if the variable is lock-free, false otherwise.</p>
<h3 class="unnumbered unlisted" id="example-127">Example</h3>
<p>Test if a couple <code>struct</code>s and an atomic <code>double</code> are lock-free. On my system, the larger <code>struct</code> is too big to be lock-free, but the other two are OK.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb449-1"><a href="stdatomic.html#cb449-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb449-2"><a href="stdatomic.html#cb449-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb449-3"><a href="stdatomic.html#cb449-3"></a></span>
<span id="cb449-4"><a href="stdatomic.html#cb449-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb449-5"><a href="stdatomic.html#cb449-5"></a><span class="op">{</span></span>
<span id="cb449-6"><a href="stdatomic.html#cb449-6"></a>    <span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb449-7"><a href="stdatomic.html#cb449-7"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb449-8"><a href="stdatomic.html#cb449-8"></a>    <span class="op">};</span></span>
<span id="cb449-9"><a href="stdatomic.html#cb449-9"></a></span>
<span id="cb449-10"><a href="stdatomic.html#cb449-10"></a>    <span class="kw">struct</span> bar <span class="op">{</span></span>
<span id="cb449-11"><a href="stdatomic.html#cb449-11"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb449-12"><a href="stdatomic.html#cb449-12"></a>    <span class="op">};</span></span>
<span id="cb449-13"><a href="stdatomic.html#cb449-13"></a></span>
<span id="cb449-14"><a href="stdatomic.html#cb449-14"></a>    <span class="kw">_Atomic</span><span class="op">(</span><span class="dt">double</span><span class="op">)</span> a<span class="op">;</span></span>
<span id="cb449-15"><a href="stdatomic.html#cb449-15"></a>    <span class="kw">struct</span> foo b<span class="op">;</span></span>
<span id="cb449-16"><a href="stdatomic.html#cb449-16"></a>    <span class="kw">struct</span> bar c<span class="op">;</span></span>
<span id="cb449-17"><a href="stdatomic.html#cb449-17"></a></span>
<span id="cb449-18"><a href="stdatomic.html#cb449-18"></a>    printf<span class="op">(</span><span class="st">&quot;a is lock-free: </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> atomic_is_lock_free<span class="op">(&amp;</span>a<span class="op">));</span></span>
<span id="cb449-19"><a href="stdatomic.html#cb449-19"></a>    printf<span class="op">(</span><span class="st">&quot;b is lock-free: </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> atomic_is_lock_free<span class="op">(&amp;</span>b<span class="op">));</span></span>
<span id="cb449-20"><a href="stdatomic.html#cb449-20"></a>    printf<span class="op">(</span><span class="st">&quot;c is lock-free: </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> atomic_is_lock_free<span class="op">(&amp;</span>c<span class="op">));</span></span>
<span id="cb449-21"><a href="stdatomic.html#cb449-21"></a><span class="op">}</span></span></code></pre></div>
<p>Output on my system (YMMV):</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb450-1"><a href="stdatomic.html#cb450-1" aria-hidden="true" tabindex="-1"></a>a is lock-free: 1</span>
<span id="cb450-2"><a href="stdatomic.html#cb450-2" aria-hidden="true" tabindex="-1"></a>b is lock-free: 1</span>
<span id="cb450-3"><a href="stdatomic.html#cb450-3" aria-hidden="true" tabindex="-1"></a>c is lock-free: 0</span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-119">See Also</h3>
<p><a href="stdatomic.html#lock-free-macros">Lock-free Macros</a></p>
<hr />
<h2 data-number="18.11" id="man-atomic_store"><span class="header-section-number">18.11</span> <code>atomic_store()</code></h2>
<p></p>
<p>Store a value in an atomic variable</p>
<h3 class="unnumbered unlisted" id="synopsis-128">Synopsis</h3>
<div class="sourceCode" id="cb451"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb451-1"><a href="stdatomic.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb451-2"><a href="stdatomic.html#cb451-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-3"><a href="stdatomic.html#cb451-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_store<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span> C desired<span class="op">);</span></span>
<span id="cb451-4"><a href="stdatomic.html#cb451-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-5"><a href="stdatomic.html#cb451-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_store_explicit<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb451-6"><a href="stdatomic.html#cb451-6" aria-hidden="true" tabindex="-1"></a>                           C desired<span class="op">,</span> memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-128">Description</h3>
<p>Store a value in an atomic variable, possible synchronized.</p>
<p>This is like a plain assignment, but with more flexibility.</p>
<p>These have the same storage effect for an <code>atomic_int x</code>:</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb452-1"><a href="stdatomic.html#cb452-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb452-2"><a href="stdatomic.html#cb452-2" aria-hidden="true" tabindex="-1"></a>atomic_store<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb452-3"><a href="stdatomic.html#cb452-3" aria-hidden="true" tabindex="-1"></a>atomic_store_explicit<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> memory_order_seq_cst<span class="op">);</span></span></code></pre></div>
<p>But the last function, <code>atomic_store_explicit()</code>, lets you specify the memory order.</p>
<p>Since this is a “release-y” operation, none of the “acquire-y” memory orders are legal. <code>order</code> can be only be <code>memory_order_seq_cst</code>, <code>memory_order_release</code>, or <code>memory_order_relaxed</code>.</p>
<p><code>order</code> cannot be <code>memory_order_acq_rel</code>, <code>memory_order_acquire</code>, or <code>memory_order_consume</code>.</p>
<h3 class="unnumbered unlisted" id="return-value-126">Return Value</h3>
<p>Returns nothing!</p>
<h3 class="unnumbered unlisted" id="example-128">Example</h3>
<div class="sourceCode" id="cb453"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb453-1"><a href="stdatomic.html#cb453-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb453-2"><a href="stdatomic.html#cb453-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb453-3"><a href="stdatomic.html#cb453-3"></a></span>
<span id="cb453-4"><a href="stdatomic.html#cb453-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb453-5"><a href="stdatomic.html#cb453-5"></a><span class="op">{</span></span>
<span id="cb453-6"><a href="stdatomic.html#cb453-6"></a>    atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb453-7"><a href="stdatomic.html#cb453-7"></a>    atomic_int y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb453-8"><a href="stdatomic.html#cb453-8"></a></span>
<span id="cb453-9"><a href="stdatomic.html#cb453-9"></a>    atomic_store<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb453-10"><a href="stdatomic.html#cb453-10"></a></span>
<span id="cb453-11"><a href="stdatomic.html#cb453-11"></a>    atomic_store_explicit<span class="op">(&amp;</span>y<span class="op">,</span> <span class="dv">20</span><span class="op">,</span> memory_order_relaxed<span class="op">);</span></span>
<span id="cb453-12"><a href="stdatomic.html#cb453-12"></a></span>
<span id="cb453-13"><a href="stdatomic.html#cb453-13"></a>    <span class="co">// Will print either &quot;10 20&quot; or &quot;10 0&quot;:</span></span>
<span id="cb453-14"><a href="stdatomic.html#cb453-14"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb453-15"><a href="stdatomic.html#cb453-15"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-120">See Also</h3>
<p><a href="stdatomic.html#man-atomic_init"><code>atomic_init()</code></a>, <a href="stdatomic.html#man-atomic_load"><code>atomic_load()</code></a>, <a href="stdatomic.html#man-atomic_load"><code>atomic_load_explicit()</code></a>, <a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange()</code></a>,<br />
<a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange_explicit()</code></a>, <a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong()</code></a>,<br />
<a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong_explicit()</code></a>, <a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak()</code></a>,<br />
<a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak_explicit()</code></a>, <a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_*()</code></a></p>
<hr />
<h2 data-number="18.12" id="man-atomic_load"><span class="header-section-number">18.12</span> <code>atomic_load()</code></h2>
<p></p>
<p>Return a value from an atomic variable</p>
<h3 class="unnumbered unlisted" id="synopsis-129">Synopsis</h3>
<div class="sourceCode" id="cb454"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb454-1"><a href="stdatomic.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb454-2"><a href="stdatomic.html#cb454-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-3"><a href="stdatomic.html#cb454-3" aria-hidden="true" tabindex="-1"></a>C atomic_load<span class="op">(</span><span class="dt">const</span> <span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">);</span></span>
<span id="cb454-4"><a href="stdatomic.html#cb454-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb454-5"><a href="stdatomic.html#cb454-5" aria-hidden="true" tabindex="-1"></a>C atomic_load_explicit<span class="op">(</span><span class="dt">const</span> <span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span> memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-129">Description</h3>
<p>For a pointer to an <code>object</code> of type <code>A</code>, atomically returns its value <code>C</code>. This is a generic function that can be used with any type.</p>
<p>The function <code>atomic_load_explicit()</code> lets you specify the memory order.</p>
<p>Since this is an “acquire-y” operation, none of the “release-y” memory orders are legal. <code>order</code> can be only be <code>memory_order_seq_cst</code>, <code>memory_order_acquire</code>, <code>memory_order_consume</code>, or <code>memory_order_relaxed</code>.</p>
<p><code>order</code> cannot be <code>memory_order_acq_rel</code> or <code>memory_order_release</code>.</p>
<h3 class="unnumbered unlisted" id="return-value-127">Return Value</h3>
<p>Returns the value stored in <code>object</code>.</p>
<h3 class="unnumbered unlisted" id="example-129">Example</h3>
<div class="sourceCode" id="cb455"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb455-1"><a href="stdatomic.html#cb455-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb455-2"><a href="stdatomic.html#cb455-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb455-3"><a href="stdatomic.html#cb455-3"></a></span>
<span id="cb455-4"><a href="stdatomic.html#cb455-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb455-5"><a href="stdatomic.html#cb455-5"></a><span class="op">{</span></span>
<span id="cb455-6"><a href="stdatomic.html#cb455-6"></a>    atomic_int x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb455-7"><a href="stdatomic.html#cb455-7"></a></span>
<span id="cb455-8"><a href="stdatomic.html#cb455-8"></a>    <span class="dt">int</span> v <span class="op">=</span> atomic_load<span class="op">(&amp;</span>x<span class="op">);</span></span>
<span id="cb455-9"><a href="stdatomic.html#cb455-9"></a></span>
<span id="cb455-10"><a href="stdatomic.html#cb455-10"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> v<span class="op">);</span>  <span class="co">// 10</span></span>
<span id="cb455-11"><a href="stdatomic.html#cb455-11"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-121">See Also</h3>
<p><a href="stdatomic.html#man-atomic_store"><code>atomic_store()</code></a>, <a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a></p>
<hr />
<h2 data-number="18.13" id="man-atomic_exchange"><span class="header-section-number">18.13</span> <code>atomic_exchange()</code></h2>
<p></p>
<p>Replace a value in an atomic object</p>
<h3 class="unnumbered unlisted" id="synopsis-130">Synopsis</h3>
<div class="sourceCode" id="cb456"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb456-1"><a href="stdatomic.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb456-2"><a href="stdatomic.html#cb456-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-3"><a href="stdatomic.html#cb456-3" aria-hidden="true" tabindex="-1"></a>C atomic_exchange<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span> C desired<span class="op">);</span></span>
<span id="cb456-4"><a href="stdatomic.html#cb456-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-5"><a href="stdatomic.html#cb456-5" aria-hidden="true" tabindex="-1"></a>C atomic_exchange_explicit<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span> C desired<span class="op">,</span></span>
<span id="cb456-6"><a href="stdatomic.html#cb456-6" aria-hidden="true" tabindex="-1"></a>                           memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-130">Description</h3>
<p>Sets the value in <code>object</code> to <code>desired</code>.</p>
<p><code>object</code> is type <code>A</code>, some atomic type.</p>
<p><code>desired</code> is type <code>C</code>, the respective non-atomic type to <code>A</code>.</p>
<p>This is very similar to <code>atomic_store()</code>, except the previous value is atomically returned.</p>
<h3 class="unnumbered unlisted" id="return-value-128">Return Value</h3>
<p>Returns the previous value of <code>object</code>.</p>
<h3 class="unnumbered unlisted" id="example-130">Example</h3>
<div class="sourceCode" id="cb457"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb457-1"><a href="stdatomic.html#cb457-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb457-2"><a href="stdatomic.html#cb457-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb457-3"><a href="stdatomic.html#cb457-3"></a></span>
<span id="cb457-4"><a href="stdatomic.html#cb457-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb457-5"><a href="stdatomic.html#cb457-5"></a><span class="op">{</span></span>
<span id="cb457-6"><a href="stdatomic.html#cb457-6"></a>    atomic_int x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb457-7"><a href="stdatomic.html#cb457-7"></a></span>
<span id="cb457-8"><a href="stdatomic.html#cb457-8"></a>    <span class="dt">int</span> previous <span class="op">=</span> atomic_exchange<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb457-9"><a href="stdatomic.html#cb457-9"></a></span>
<span id="cb457-10"><a href="stdatomic.html#cb457-10"></a>    printf<span class="op">(</span><span class="st">&quot;x is  </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb457-11"><a href="stdatomic.html#cb457-11"></a>    printf<span class="op">(</span><span class="st">&quot;x was </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> previous<span class="op">);</span></span>
<span id="cb457-12"><a href="stdatomic.html#cb457-12"></a><span class="op">}</span></span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb458-1"><a href="stdatomic.html#cb458-1" aria-hidden="true" tabindex="-1"></a>x is  20</span>
<span id="cb458-2"><a href="stdatomic.html#cb458-2" aria-hidden="true" tabindex="-1"></a>x was 10</span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-122">See Also</h3>
<p><a href="stdatomic.html#man-atomic_init"><code>atomic_init()</code></a>, <a href="stdatomic.html#man-atomic_load"><code>atomic_load()</code></a>, <a href="stdatomic.html#man-atomic_load"><code>atomic_load_explicit()</code></a>, <a href="stdatomic.html#man-atomic_store"><code>atomic_store()</code></a>,<br />
<a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a> <a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong()</code></a>,<br />
<a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong_explicit()</code></a>, <a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak()</code></a>,<br />
<a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak_explicit()</code></a></p>
<hr />
<h2 data-number="18.14" id="man-atomic_compare_exchange"><span class="header-section-number">18.14</span> <code>atomic_compare_exchange_*()</code></h2>
<p></p>
<p>Atomic compare and exchange</p>
<h3 class="unnumbered unlisted" id="synopsis-131">Synopsis</h3>
<div class="sourceCode" id="cb459"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb459-1"><a href="stdatomic.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb459-2"><a href="stdatomic.html#cb459-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-3"><a href="stdatomic.html#cb459-3" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_compare_exchange_strong<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb459-4"><a href="stdatomic.html#cb459-4" aria-hidden="true" tabindex="-1"></a>                                     C <span class="op">*</span>expected<span class="op">,</span> C desired<span class="op">);</span></span>
<span id="cb459-5"><a href="stdatomic.html#cb459-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-6"><a href="stdatomic.html#cb459-6" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_compare_exchange_strong_explicit<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb459-7"><a href="stdatomic.html#cb459-7" aria-hidden="true" tabindex="-1"></a>                                              C <span class="op">*</span>expected<span class="op">,</span> C desired<span class="op">,</span></span>
<span id="cb459-8"><a href="stdatomic.html#cb459-8" aria-hidden="true" tabindex="-1"></a>                                              memory_order success<span class="op">,</span></span>
<span id="cb459-9"><a href="stdatomic.html#cb459-9" aria-hidden="true" tabindex="-1"></a>                                              memory_order failure<span class="op">);</span></span>
<span id="cb459-10"><a href="stdatomic.html#cb459-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-11"><a href="stdatomic.html#cb459-11" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_compare_exchange_weak<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb459-12"><a href="stdatomic.html#cb459-12" aria-hidden="true" tabindex="-1"></a>                                   C <span class="op">*</span>expected<span class="op">,</span> C desired<span class="op">);</span></span>
<span id="cb459-13"><a href="stdatomic.html#cb459-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb459-14"><a href="stdatomic.html#cb459-14" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_compare_exchange_weak_explicit<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb459-15"><a href="stdatomic.html#cb459-15" aria-hidden="true" tabindex="-1"></a>                                            C <span class="op">*</span>expected<span class="op">,</span> C desired<span class="op">,</span></span>
<span id="cb459-16"><a href="stdatomic.html#cb459-16" aria-hidden="true" tabindex="-1"></a>                                            memory_order success<span class="op">,</span></span>
<span id="cb459-17"><a href="stdatomic.html#cb459-17" aria-hidden="true" tabindex="-1"></a>                                            memory_order failure<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-131">Description</h3>
<p>The venerable basis for some many things lock-free: compare and exchange.</p>
<p>In the above prototypes, <code>A</code> is the type of the atomic object, and <code>C</code> is the equivalent base type.</p>
<p>Ignoring the <code>_explicit</code> versions for a moment, what these do is:</p>
<ul>
<li><p>If the value pointed to by <code>object</code> is equal to the value pointed to by <code>expected</code>, then the value pointed to by <code>object</code> is set to <code>desired</code>. And the function returns <code>true</code> indicating the exchange did take place.</p></li>
<li><p>Else the value pointed to by <code>expected</code> (yes, <code>expected</code>) is set to <code>desired</code> and the function returns <code>false</code> indicating the exchange did not take place.</p></li>
</ul>
<p>Pseudocode for the exchange would look like this<a href="wctype.html#fn41" class="footnote-ref" id="fnref41" role="doc-noteref"><sup>41</sup></a>:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb460-1"><a href="stdatomic.html#cb460-1" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> compare_exchange<span class="op">(</span>atomic_A <span class="op">*</span>object<span class="op">,</span> C <span class="op">*</span>expected<span class="op">,</span> C desired<span class="op">)</span></span>
<span id="cb460-2"><a href="stdatomic.html#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb460-3"><a href="stdatomic.html#cb460-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(*</span>object is the same as <span class="op">*</span>expected<span class="op">)</span> <span class="op">{</span></span>
<span id="cb460-4"><a href="stdatomic.html#cb460-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>object <span class="op">=</span> desired</span>
<span id="cb460-5"><a href="stdatomic.html#cb460-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">true</span></span>
<span id="cb460-6"><a href="stdatomic.html#cb460-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb460-7"><a href="stdatomic.html#cb460-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-8"><a href="stdatomic.html#cb460-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>expected <span class="op">=</span> desired</span>
<span id="cb460-9"><a href="stdatomic.html#cb460-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span></span>
<span id="cb460-10"><a href="stdatomic.html#cb460-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>_weak</code> variants might spontaneously fail, so even if <code>*object == *desired</code>, it might not change the value and will return <code>false</code>. So you’ll want that in a loop if you use it<a href="wctype.html#fn42" class="footnote-ref" id="fnref42" role="doc-noteref"><sup>42</sup></a>.</p>
<p>The <code>_explicit</code> variants have two memory orders: <code>success</code> if <code>*object</code> is set to <code>desired</code>, and <code>failure</code> if it is not.</p>
<p>These are test-and-set functions, so you can use <code>memory_order_acq_rel</code> with the <code>_explicit</code> variants.</p>
<h3 class="unnumbered unlisted" id="return-value-129">Return Value</h3>
<p>Returns <code>true</code> if <code>*object</code> was <code>*expected</code>. Otherwise, <code>false</code>.</p>
<h3 class="unnumbered unlisted" id="example-131">Example</h3>
<p>A contrived example where multiple threads add <code>2</code> to a shared value in a lock-free way.</p>
<p>(It would be better to use <code>+= 2</code> to get this done in real life unless you were using some <code>_explicit</code> wizardry.)</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb461-1"><a href="stdatomic.html#cb461-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb461-2"><a href="stdatomic.html#cb461-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb461-3"><a href="stdatomic.html#cb461-3"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb461-4"><a href="stdatomic.html#cb461-4"></a></span>
<span id="cb461-5"><a href="stdatomic.html#cb461-5"></a><span class="pp">#define LOOP_COUNT </span><span class="dv">10000</span></span>
<span id="cb461-6"><a href="stdatomic.html#cb461-6"></a></span>
<span id="cb461-7"><a href="stdatomic.html#cb461-7"></a>atomic_int value<span class="op">;</span></span>
<span id="cb461-8"><a href="stdatomic.html#cb461-8"></a></span>
<span id="cb461-9"><a href="stdatomic.html#cb461-9"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb461-10"><a href="stdatomic.html#cb461-10"></a><span class="op">{</span></span>
<span id="cb461-11"><a href="stdatomic.html#cb461-11"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb461-12"><a href="stdatomic.html#cb461-12"></a></span>
<span id="cb461-13"><a href="stdatomic.html#cb461-13"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> LOOP_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb461-14"><a href="stdatomic.html#cb461-14"></a></span>
<span id="cb461-15"><a href="stdatomic.html#cb461-15"></a>        <span class="dt">int</span> cur <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb461-16"><a href="stdatomic.html#cb461-16"></a>        <span class="dt">int</span> next<span class="op">;</span></span>
<span id="cb461-17"><a href="stdatomic.html#cb461-17"></a></span>
<span id="cb461-18"><a href="stdatomic.html#cb461-18"></a>        <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb461-19"><a href="stdatomic.html#cb461-19"></a>            next <span class="op">=</span> cur <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb461-20"><a href="stdatomic.html#cb461-20"></a>        <span class="op">}</span> <span class="cf">while</span> <span class="op">(!</span>atomic_compare_exchange_strong<span class="op">(&amp;</span>value<span class="op">,</span> <span class="op">&amp;</span>cur<span class="op">,</span> next<span class="op">));</span></span>
<span id="cb461-21"><a href="stdatomic.html#cb461-21"></a>    <span class="op">}</span></span>
<span id="cb461-22"><a href="stdatomic.html#cb461-22"></a></span>
<span id="cb461-23"><a href="stdatomic.html#cb461-23"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb461-24"><a href="stdatomic.html#cb461-24"></a><span class="op">}</span></span>
<span id="cb461-25"><a href="stdatomic.html#cb461-25"></a></span>
<span id="cb461-26"><a href="stdatomic.html#cb461-26"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb461-27"><a href="stdatomic.html#cb461-27"></a><span class="op">{</span></span>
<span id="cb461-28"><a href="stdatomic.html#cb461-28"></a>    thrd_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb461-29"><a href="stdatomic.html#cb461-29"></a></span>
<span id="cb461-30"><a href="stdatomic.html#cb461-30"></a>    thrd_create<span class="op">(&amp;</span>t1<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb461-31"><a href="stdatomic.html#cb461-31"></a>    thrd_create<span class="op">(&amp;</span>t2<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb461-32"><a href="stdatomic.html#cb461-32"></a></span>
<span id="cb461-33"><a href="stdatomic.html#cb461-33"></a>    thrd_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb461-34"><a href="stdatomic.html#cb461-34"></a>    thrd_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb461-35"><a href="stdatomic.html#cb461-35"></a>    </span>
<span id="cb461-36"><a href="stdatomic.html#cb461-36"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> should equal </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> value<span class="op">,</span> LOOP_COUNT <span class="op">*</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb461-37"><a href="stdatomic.html#cb461-37"></a><span class="op">}</span></span></code></pre></div>
<p>Just replacing this with <code>value = value + 2</code> causes data trampling.</p>
<h3 class="unnumbered unlisted" id="see-also-123">See Also</h3>
<p><a href="stdatomic.html#man-atomic_load"><code>atomic_load()</code></a>, <a href="stdatomic.html#man-atomic_load"><code>atomic_load_explicit()</code></a>, <a href="stdatomic.html#man-atomic_store"><code>atomic_store()</code></a>, <a href="stdatomic.html#man-atomic_store"><code>atomic_store_explicit()</code></a>, <a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange()</code></a>, <a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange_explicit()</code></a>, <a href="stdatomic.html#man-atomic_fetch"><code>atomic_fetch_*()</code></a></p>
<hr />
<h2 data-number="18.15" id="man-atomic_fetch"><span class="header-section-number">18.15</span> <code>atomic_fetch_*()</code></h2>
<p></p>
<p>Atomically modify atomic variables</p>
<h3 class="unnumbered unlisted" id="synopsis-132">Synopsis</h3>
<div class="sourceCode" id="cb462"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb462-1"><a href="stdatomic.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb462-2"><a href="stdatomic.html#cb462-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-3"><a href="stdatomic.html#cb462-3" aria-hidden="true" tabindex="-1"></a>C atomic_fetch_KEY<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span> M operand<span class="op">);</span></span>
<span id="cb462-4"><a href="stdatomic.html#cb462-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb462-5"><a href="stdatomic.html#cb462-5" aria-hidden="true" tabindex="-1"></a>C atomic_fetch_KEY_explicit<span class="op">(</span><span class="dt">volatile</span> A <span class="op">*</span>object<span class="op">,</span> M operand<span class="op">,</span></span>
<span id="cb462-6"><a href="stdatomic.html#cb462-6" aria-hidden="true" tabindex="-1"></a>                            memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-132">Description</h3>
<p>These are actually a group of 10 functions. You substitute one of the following for <code>KEY</code> to perform that operation:</p>
<ul>
<li><code>add</code></li>
<li><code>sub</code></li>
<li><code>or</code></li>
<li><code>xor</code></li>
<li><code>and</code></li>
</ul>
<p>So these functions can add or subtract values to or from an atomic variable, or can perform bitwise-OR, XOR, or AND on them.</p>
<p>Use it with integer or pointer types. Though the spec is a little vague on the matter, other types make C unhappy. It goes out of its way to avoid undefined behavior with signed integers, as well:</p>
<p>C18 §7.17.7.5 ¶3:</p>
<blockquote>
<p>For signed integer types, arithmetic is defined to use two’s complement representation with silent wrap-around on overflow; there are no undefined results.</p>
</blockquote>
<p>In the synopsis, above, <code>A</code> is an atomic type, and <code>M</code> is the corresponding non-atomic type for <code>A</code> (or <code>ptrdiff_t</code> for atomic pointers), and <code>C</code> is the corresponding non-atomic type for <code>A</code>.</p>
<p>For example, here are some operations on an <code>atomic_int</code>.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb463-1"><a href="stdatomic.html#cb463-1" aria-hidden="true" tabindex="-1"></a>atomic_fetch_add<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb463-2"><a href="stdatomic.html#cb463-2" aria-hidden="true" tabindex="-1"></a>atomic_fetch_sub<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">37</span><span class="op">);</span></span>
<span id="cb463-3"><a href="stdatomic.html#cb463-3" aria-hidden="true" tabindex="-1"></a>atomic_fetch_xor<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">3490</span><span class="op">);</span></span></code></pre></div>
<p>They are the same as <code>+=</code>, <code>-=</code>, <code>|=</code>, <code>^=</code> and <code>&amp;=</code>, except the return value is the <em>previous</em> value of the atomic object. (With the assignment operators, the value of the expression is that <em>after</em> its evaluation.)</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb464-1"><a href="stdatomic.html#cb464-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb464-2"><a href="stdatomic.html#cb464-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> prev <span class="op">=</span> atomic_fetch_add<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb464-3"><a href="stdatomic.html#cb464-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> prev<span class="op">,</span> x<span class="op">);</span>  <span class="co">// 10 30</span></span></code></pre></div>
<p>versus:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb465-1"><a href="stdatomic.html#cb465-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb465-2"><a href="stdatomic.html#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> prev <span class="op">=</span> <span class="op">(</span>x <span class="op">+=</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb465-3"><a href="stdatomic.html#cb465-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> prev<span class="op">,</span> x<span class="op">);</span>  <span class="co">// 30 30</span></span></code></pre></div>
<p>And, of course, the <code>_explicit</code> version allows you to specify a memory order and all the assignment operators are <code>memory_order_seq_cst</code>.</p>
<h3 class="unnumbered unlisted" id="return-value-130">Return Value</h3>
<p>Returns the previous value of the atomic object before the modification.</p>
<h3 class="unnumbered unlisted" id="example-132">Example</h3>
<div class="sourceCode" id="cb466"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb466-1"><a href="stdatomic.html#cb466-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb466-2"><a href="stdatomic.html#cb466-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb466-3"><a href="stdatomic.html#cb466-3"></a></span>
<span id="cb466-4"><a href="stdatomic.html#cb466-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb466-5"><a href="stdatomic.html#cb466-5"></a><span class="op">{</span></span>
<span id="cb466-6"><a href="stdatomic.html#cb466-6"></a>    atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb466-7"><a href="stdatomic.html#cb466-7"></a>    <span class="dt">int</span> prev<span class="op">;</span></span>
<span id="cb466-8"><a href="stdatomic.html#cb466-8"></a></span>
<span id="cb466-9"><a href="stdatomic.html#cb466-9"></a>    atomic_fetch_add<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">3490</span><span class="op">);</span></span>
<span id="cb466-10"><a href="stdatomic.html#cb466-10"></a>    atomic_fetch_sub<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">12</span><span class="op">);</span></span>
<span id="cb466-11"><a href="stdatomic.html#cb466-11"></a>    atomic_fetch_xor<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">444</span><span class="op">);</span></span>
<span id="cb466-12"><a href="stdatomic.html#cb466-12"></a>    atomic_fetch_or<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">12</span><span class="op">);</span></span>
<span id="cb466-13"><a href="stdatomic.html#cb466-13"></a>    prev <span class="op">=</span> atomic_fetch_and<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">42</span><span class="op">);</span></span>
<span id="cb466-14"><a href="stdatomic.html#cb466-14"></a></span>
<span id="cb466-15"><a href="stdatomic.html#cb466-15"></a>    printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> prev<span class="op">,</span> x<span class="op">);</span>   <span class="co">// 3118 42</span></span>
<span id="cb466-16"><a href="stdatomic.html#cb466-16"></a><span class="op">}</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-124">See Also</h3>
<p><a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange()</code></a>, <a href="stdatomic.html#man-atomic_exchange"><code>atomic_exchange_explicit()</code></a>, <a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong()</code></a>,<br />
<a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_strong_explicit()</code></a>, <a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak()</code></a>,<br />
<a href="stdatomic.html#man-atomic_compare_exchange"><code>atomic_compare_exchange_weak_explicit()</code></a></p>
<hr />
<h2 data-number="18.16" id="man-atomic_flag_test_and_set"><span class="header-section-number">18.16</span> <code>atomic_flag_test_and_set()</code></h2>
<p></p>
<p>Test and set an atomic flag</p>
<h3 class="unnumbered unlisted" id="synopsis-133">Synopsis</h3>
<div class="sourceCode" id="cb467"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb467-1"><a href="stdatomic.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb467-2"><a href="stdatomic.html#cb467-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-3"><a href="stdatomic.html#cb467-3" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_flag_test_and_set<span class="op">(</span><span class="dt">volatile</span> atomic_flag <span class="op">*</span>object<span class="op">);</span></span>
<span id="cb467-4"><a href="stdatomic.html#cb467-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb467-5"><a href="stdatomic.html#cb467-5" aria-hidden="true" tabindex="-1"></a><span class="dt">_Bool</span> atomic_flag_test_and_set_explicit<span class="op">(</span><span class="dt">volatile</span> atomic_flag <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb467-6"><a href="stdatomic.html#cb467-6" aria-hidden="true" tabindex="-1"></a>                                        memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-133">Description</h3>
<p>One of the venerable old functions of lock-free programming, this function sets the given atomic flag in <code>object</code>, and returns the previous value of the flag.</p>
<p>As usual, the <code>_explicit</code> allows you to specify an alternate memory order.</p>
<h3 class="unnumbered unlisted" id="return-value-131">Return Value</h3>
<p>Returns <code>true</code> if the flag was set previously, and <code>false</code> if it wasn’t.</p>
<h3 class="unnumbered unlisted" id="example-133">Example</h3>
<p>Using test-and-set to implement a spin lock<a href="wctype.html#fn43" class="footnote-ref" id="fnref43" role="doc-noteref"><sup>43</sup></a>:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb468-1"><a href="stdatomic.html#cb468-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb468-2"><a href="stdatomic.html#cb468-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb468-3"><a href="stdatomic.html#cb468-3"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb468-4"><a href="stdatomic.html#cb468-4"></a></span>
<span id="cb468-5"><a href="stdatomic.html#cb468-5"></a><span class="co">// Shared non-atomic struct</span></span>
<span id="cb468-6"><a href="stdatomic.html#cb468-6"></a><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb468-7"><a href="stdatomic.html#cb468-7"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb468-8"><a href="stdatomic.html#cb468-8"></a><span class="op">}</span> s <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb468-9"><a href="stdatomic.html#cb468-9"></a></span>
<span id="cb468-10"><a href="stdatomic.html#cb468-10"></a>atomic_flag f <span class="op">=</span> ATOMIC_FLAG_INIT<span class="op">;</span></span>
<span id="cb468-11"><a href="stdatomic.html#cb468-11"></a></span>
<span id="cb468-12"><a href="stdatomic.html#cb468-12"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb468-13"><a href="stdatomic.html#cb468-13"></a><span class="op">{</span></span>
<span id="cb468-14"><a href="stdatomic.html#cb468-14"></a>    <span class="dt">int</span> tid <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb468-15"><a href="stdatomic.html#cb468-15"></a></span>
<span id="cb468-16"><a href="stdatomic.html#cb468-16"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: waiting for lock...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">);</span></span>
<span id="cb468-17"><a href="stdatomic.html#cb468-17"></a></span>
<span id="cb468-18"><a href="stdatomic.html#cb468-18"></a>    <span class="cf">while</span> <span class="op">(</span>atomic_flag_test_and_set<span class="op">(&amp;</span>f<span class="op">));</span></span>
<span id="cb468-19"><a href="stdatomic.html#cb468-19"></a></span>
<span id="cb468-20"><a href="stdatomic.html#cb468-20"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: got lock, s is {</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">,</span></span>
<span id="cb468-21"><a href="stdatomic.html#cb468-21"></a>                                                       s<span class="op">.</span>x<span class="op">,</span> s<span class="op">.</span>y<span class="op">,</span> s<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb468-22"><a href="stdatomic.html#cb468-22"></a>    s<span class="op">.</span>x <span class="op">=</span> <span class="op">(</span>tid <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb468-23"><a href="stdatomic.html#cb468-23"></a>    s<span class="op">.</span>y <span class="op">=</span> <span class="op">(</span>tid <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb468-24"><a href="stdatomic.html#cb468-24"></a>    s<span class="op">.</span>z <span class="op">=</span> <span class="op">(</span>tid <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb468-25"><a href="stdatomic.html#cb468-25"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: set s to {</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">,</span> s<span class="op">.</span>x<span class="op">,</span> s<span class="op">.</span>y<span class="op">,</span> s<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb468-26"><a href="stdatomic.html#cb468-26"></a></span>
<span id="cb468-27"><a href="stdatomic.html#cb468-27"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: releasing lock...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">);</span></span>
<span id="cb468-28"><a href="stdatomic.html#cb468-28"></a>    atomic_flag_clear<span class="op">(&amp;</span>f<span class="op">);</span></span>
<span id="cb468-29"><a href="stdatomic.html#cb468-29"></a></span>
<span id="cb468-30"><a href="stdatomic.html#cb468-30"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb468-31"><a href="stdatomic.html#cb468-31"></a><span class="op">}</span></span>
<span id="cb468-32"><a href="stdatomic.html#cb468-32"></a></span>
<span id="cb468-33"><a href="stdatomic.html#cb468-33"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb468-34"><a href="stdatomic.html#cb468-34"></a><span class="op">{</span></span>
<span id="cb468-35"><a href="stdatomic.html#cb468-35"></a>    thrd_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb468-36"><a href="stdatomic.html#cb468-36"></a>    <span class="dt">int</span> tid<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">};</span></span>
<span id="cb468-37"><a href="stdatomic.html#cb468-37"></a></span>
<span id="cb468-38"><a href="stdatomic.html#cb468-38"></a>    thrd_create<span class="op">(&amp;</span>t1<span class="op">,</span> run<span class="op">,</span> tid<span class="op">+</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb468-39"><a href="stdatomic.html#cb468-39"></a>    thrd_create<span class="op">(&amp;</span>t2<span class="op">,</span> run<span class="op">,</span> tid<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb468-40"><a href="stdatomic.html#cb468-40"></a></span>
<span id="cb468-41"><a href="stdatomic.html#cb468-41"></a>    thrd_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb468-42"><a href="stdatomic.html#cb468-42"></a>    thrd_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb468-43"><a href="stdatomic.html#cb468-43"></a><span class="op">}</span></span></code></pre></div>
<p>Example output (varies run to run):</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb469-1"><a href="stdatomic.html#cb469-1" aria-hidden="true" tabindex="-1"></a>Thread 0: waiting for lock...</span>
<span id="cb469-2"><a href="stdatomic.html#cb469-2" aria-hidden="true" tabindex="-1"></a>Thread 0: got lock, s is {1, 2, 3}</span>
<span id="cb469-3"><a href="stdatomic.html#cb469-3" aria-hidden="true" tabindex="-1"></a>Thread 1: waiting for lock...</span>
<span id="cb469-4"><a href="stdatomic.html#cb469-4" aria-hidden="true" tabindex="-1"></a>Thread 0: set s to {5, 6, 7}</span>
<span id="cb469-5"><a href="stdatomic.html#cb469-5" aria-hidden="true" tabindex="-1"></a>Thread 0: releasing lock...</span>
<span id="cb469-6"><a href="stdatomic.html#cb469-6" aria-hidden="true" tabindex="-1"></a>Thread 1: got lock, s is {5, 6, 7}</span>
<span id="cb469-7"><a href="stdatomic.html#cb469-7" aria-hidden="true" tabindex="-1"></a>Thread 1: set s to {10, 11, 12}</span>
<span id="cb469-8"><a href="stdatomic.html#cb469-8" aria-hidden="true" tabindex="-1"></a>Thread 1: releasing lock...</span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-125">See Also</h3>
<p><a href="stdatomic.html#man-atomic_flag_clear"><code>atomic_flag_clear()</code></a></p>
<hr />
<h2 data-number="18.17" id="man-atomic_flag_clear"><span class="header-section-number">18.17</span> <code>atomic_flag_clear()</code></h2>
<p></p>
<p>Clear an atomic flag</p>
<h3 class="unnumbered unlisted" id="synopsis-134">Synopsis</h3>
<div class="sourceCode" id="cb470"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb470-1"><a href="stdatomic.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb470-2"><a href="stdatomic.html#cb470-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-3"><a href="stdatomic.html#cb470-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_flag_clear<span class="op">(</span><span class="dt">volatile</span> atomic_flag <span class="op">*</span>object<span class="op">);</span></span>
<span id="cb470-4"><a href="stdatomic.html#cb470-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-5"><a href="stdatomic.html#cb470-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> atomic_flag_clear_explicit<span class="op">(</span><span class="dt">volatile</span> atomic_flag <span class="op">*</span>object<span class="op">,</span></span>
<span id="cb470-6"><a href="stdatomic.html#cb470-6" aria-hidden="true" tabindex="-1"></a>                                memory_order order<span class="op">);</span></span></code></pre></div>
<h3 class="unnumbered unlisted" id="description-134">Description</h3>
<p>Clears an atomic flag.</p>
<p>As usual, the <code>_explicit</code> allows you to specify an alternate memory order.</p>
<h3 class="unnumbered unlisted" id="return-value-132">Return Value</h3>
<p>Returns nothing!</p>
<h3 class="unnumbered unlisted" id="example-134">Example</h3>
<p>Using test-and-set to implement a spin lock<a href="wctype.html#fn44" class="footnote-ref" id="fnref44" role="doc-noteref"><sup>44</sup></a>:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb471-1"><a href="stdatomic.html#cb471-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb471-2"><a href="stdatomic.html#cb471-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb471-3"><a href="stdatomic.html#cb471-3"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb471-4"><a href="stdatomic.html#cb471-4"></a></span>
<span id="cb471-5"><a href="stdatomic.html#cb471-5"></a><span class="co">// Shared non-atomic struct</span></span>
<span id="cb471-6"><a href="stdatomic.html#cb471-6"></a><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb471-7"><a href="stdatomic.html#cb471-7"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb471-8"><a href="stdatomic.html#cb471-8"></a><span class="op">}</span> s <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb471-9"><a href="stdatomic.html#cb471-9"></a></span>
<span id="cb471-10"><a href="stdatomic.html#cb471-10"></a>atomic_flag f <span class="op">=</span> ATOMIC_FLAG_INIT<span class="op">;</span></span>
<span id="cb471-11"><a href="stdatomic.html#cb471-11"></a></span>
<span id="cb471-12"><a href="stdatomic.html#cb471-12"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb471-13"><a href="stdatomic.html#cb471-13"></a><span class="op">{</span></span>
<span id="cb471-14"><a href="stdatomic.html#cb471-14"></a>    <span class="dt">int</span> tid <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb471-15"><a href="stdatomic.html#cb471-15"></a></span>
<span id="cb471-16"><a href="stdatomic.html#cb471-16"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: waiting for lock...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">);</span></span>
<span id="cb471-17"><a href="stdatomic.html#cb471-17"></a></span>
<span id="cb471-18"><a href="stdatomic.html#cb471-18"></a>    <span class="cf">while</span> <span class="op">(</span>atomic_flag_test_and_set<span class="op">(&amp;</span>f<span class="op">));</span></span>
<span id="cb471-19"><a href="stdatomic.html#cb471-19"></a></span>
<span id="cb471-20"><a href="stdatomic.html#cb471-20"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: got lock, s is {</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">,</span></span>
<span id="cb471-21"><a href="stdatomic.html#cb471-21"></a>                                                       s<span class="op">.</span>x<span class="op">,</span> s<span class="op">.</span>y<span class="op">,</span> s<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb471-22"><a href="stdatomic.html#cb471-22"></a>    s<span class="op">.</span>x <span class="op">=</span> <span class="op">(</span>tid <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb471-23"><a href="stdatomic.html#cb471-23"></a>    s<span class="op">.</span>y <span class="op">=</span> <span class="op">(</span>tid <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb471-24"><a href="stdatomic.html#cb471-24"></a>    s<span class="op">.</span>z <span class="op">=</span> <span class="op">(</span>tid <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb471-25"><a href="stdatomic.html#cb471-25"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: set s to {</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">}</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">,</span> s<span class="op">.</span>x<span class="op">,</span> s<span class="op">.</span>y<span class="op">,</span> s<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb471-26"><a href="stdatomic.html#cb471-26"></a></span>
<span id="cb471-27"><a href="stdatomic.html#cb471-27"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st">: releasing lock...</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> tid<span class="op">);</span></span>
<span id="cb471-28"><a href="stdatomic.html#cb471-28"></a>    atomic_flag_clear<span class="op">(&amp;</span>f<span class="op">);</span></span>
<span id="cb471-29"><a href="stdatomic.html#cb471-29"></a></span>
<span id="cb471-30"><a href="stdatomic.html#cb471-30"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb471-31"><a href="stdatomic.html#cb471-31"></a><span class="op">}</span></span>
<span id="cb471-32"><a href="stdatomic.html#cb471-32"></a></span>
<span id="cb471-33"><a href="stdatomic.html#cb471-33"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb471-34"><a href="stdatomic.html#cb471-34"></a><span class="op">{</span></span>
<span id="cb471-35"><a href="stdatomic.html#cb471-35"></a>    thrd_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb471-36"><a href="stdatomic.html#cb471-36"></a>    <span class="dt">int</span> tid<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">};</span></span>
<span id="cb471-37"><a href="stdatomic.html#cb471-37"></a></span>
<span id="cb471-38"><a href="stdatomic.html#cb471-38"></a>    thrd_create<span class="op">(&amp;</span>t1<span class="op">,</span> run<span class="op">,</span> tid<span class="op">+</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb471-39"><a href="stdatomic.html#cb471-39"></a>    thrd_create<span class="op">(&amp;</span>t2<span class="op">,</span> run<span class="op">,</span> tid<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb471-40"><a href="stdatomic.html#cb471-40"></a></span>
<span id="cb471-41"><a href="stdatomic.html#cb471-41"></a>    thrd_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb471-42"><a href="stdatomic.html#cb471-42"></a>    thrd_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb471-43"><a href="stdatomic.html#cb471-43"></a><span class="op">}</span></span></code></pre></div>
<p>Example output (varies run to run):</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb472-1"><a href="stdatomic.html#cb472-1" aria-hidden="true" tabindex="-1"></a>Thread 0: waiting for lock...</span>
<span id="cb472-2"><a href="stdatomic.html#cb472-2" aria-hidden="true" tabindex="-1"></a>Thread 0: got lock, s is {1, 2, 3}</span>
<span id="cb472-3"><a href="stdatomic.html#cb472-3" aria-hidden="true" tabindex="-1"></a>Thread 1: waiting for lock...</span>
<span id="cb472-4"><a href="stdatomic.html#cb472-4" aria-hidden="true" tabindex="-1"></a>Thread 0: set s to {5, 6, 7}</span>
<span id="cb472-5"><a href="stdatomic.html#cb472-5" aria-hidden="true" tabindex="-1"></a>Thread 0: releasing lock...</span>
<span id="cb472-6"><a href="stdatomic.html#cb472-6" aria-hidden="true" tabindex="-1"></a>Thread 1: got lock, s is {5, 6, 7}</span>
<span id="cb472-7"><a href="stdatomic.html#cb472-7" aria-hidden="true" tabindex="-1"></a>Thread 1: set s to {10, 11, 12}</span>
<span id="cb472-8"><a href="stdatomic.html#cb472-8" aria-hidden="true" tabindex="-1"></a>Thread 1: releasing lock...</span></code></pre></div>
<h3 class="unnumbered unlisted" id="see-also-126">See Also</h3>
<p><a href="stdatomic.html#man-atomic_flag_test_and_set"><code>atomic_flag_test_and_set()</code></a></p>
<!--
***
## `example()` {#man-example}

\index{example() function@\texttt{example()} function|textit}

### Synopsis {.unnumbered .unlisted}

``` {.c}
```

### Description {.unnumbered .unlisted}

### Return Value {.unnumbered .unlisted}

### Example {.unnumbered .unlisted}

``` {.c .numberLines}
```

### See Also {.unnumbered .unlisted}

[`example()`](#man-example),
-->
<!-- BG_NEW_CHAPTER -->
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<hr><div style="text-align:center"><span><a href="stdarg.html" rel="prev">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="stdbit.html" rel="next">Next</a></span></div></body>
</html>
