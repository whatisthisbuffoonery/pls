<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Beej's Guide to Interprocess Communication</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!-- BG custom styling -->
  <style type="text/css">
  /* Fix for line numbers not visible */
  pre.numberSource code > span {
      left: -1em;
  }
  pre.numberSource {
      margin-left: initial;
  }

  /* Put some space after the section numbers */
  span.toc-section-number::after {
      content: "\a0\a0\a0";  /* non-breaking whitespace */
  }

  /* Hide underlines on code number links */
  pre > code.sourceCode > span > a:first-child::before {
      text-decoration: none;
  }

  /* Color the source blocks */
  div.sourceCode {
      background-color: #f0f0f0;
  }

  /* Fix iOS big text rendering issue */
  pre > code.sourceCode > span {
      display: initial;
  }


  /* Color the inline code */
  code:not(.sourceCode) {
      background: #f0f0f0;
      padding-left: 0.2em;
      padding-right: 0.2em;
      border-radius: 0.2em;
  }

  pre.sourceCode {
      border: 1px solid #ccc;
      padding: 0.5em;
      border-radius: 0.2em;
  }

  /* Keep code tags from wrapping in tables */
  tbody code {
      white-space: nowrap;
  }

  /* Prevent hyphenation and hyphen breaks in code*/
  code {
      word-break: keep-all;
  }

  td {
      vertical-align: top;
  }

  body {
      font-size: 12pt;
      max-width: 43em;
      font-family: sans-serif;
  }

  html {
      background: #f9f9f9;
  }

  figure > embed {
      max-width: 100%;
  }

  figure {
      text-align: center;
      margin-top: 2em;
      margin-bottom: 2em;
  }

  figcaption {
      font-size: 0.9em;
      font-style: italic;
      margin-top: 0.6em;
  }

  body {
      counter-reset: figure-counter-major;
      counter-reset: figure-counter-minor;
  }

  figure {
      counter-increment: figure-counter-minor;
  }

  figcaption::before {
      content: "Figure " counter(figure-counter-major) "." counter(figure-counter-minor) ": ";
  }

  blockquote {
      border-left: 2px solid #bbb;
      color: #444;
  }

  /* Contents */

  nav[role="doc-toc"] > ul > li {
    font-weight: bold;
    margin-top: 1.2em;
  }

  nav[role="doc-toc"] > ul > li:first {
    font-weight: bold;
    margin-top: initial;
  }

  nav[role="doc-toc"] > ul > li > ul {
    font-weight: normal;
    margin-top: 0.3em;
  }

  /*
  In multipage, we need to reset the figure counter to the chapter
  number. Luckily, this is in the <h1 data-number> attribute. Unluckily,
  there is no way to get this in a general way.

  This doesn't work:

    h1[data-number] {
      counter-set: figure-counter-major attr(data-number);
    }

  Nor this:

    h1[data-number] {
      --figure-counter-major-value: attr(data-number);
      counter-set: figure-counter-major var(--figure-counter-major-value);
    }

  So, dumbly, we have a bunch of rules for all these sections, up to the
  maximum possible section.

  Here's a program to generate them:

    for (let i = 1; i < 100; i++)
        console.log(`h1[data-number="${i}"]{counter-set:figure-counter-major ${i};counter-reset:figure-counter-minor;}`);

  Note to self: never write a book with more than 99 frickin' chapters.
  */

  h1[data-number="1"]{counter-set:figure-counter-major 1;counter-reset:figure-counter-minor;}
  h1[data-number="2"]{counter-set:figure-counter-major 2;counter-reset:figure-counter-minor;}
  h1[data-number="3"]{counter-set:figure-counter-major 3;counter-reset:figure-counter-minor;}
  h1[data-number="4"]{counter-set:figure-counter-major 4;counter-reset:figure-counter-minor;}
  h1[data-number="5"]{counter-set:figure-counter-major 5;counter-reset:figure-counter-minor;}
  h1[data-number="6"]{counter-set:figure-counter-major 6;counter-reset:figure-counter-minor;}
  h1[data-number="7"]{counter-set:figure-counter-major 7;counter-reset:figure-counter-minor;}
  h1[data-number="8"]{counter-set:figure-counter-major 8;counter-reset:figure-counter-minor;}
  h1[data-number="9"]{counter-set:figure-counter-major 9;counter-reset:figure-counter-minor;}
  h1[data-number="10"]{counter-set:figure-counter-major 10;counter-reset:figure-counter-minor;}
  h1[data-number="11"]{counter-set:figure-counter-major 11;counter-reset:figure-counter-minor;}
  h1[data-number="12"]{counter-set:figure-counter-major 12;counter-reset:figure-counter-minor;}
  h1[data-number="13"]{counter-set:figure-counter-major 13;counter-reset:figure-counter-minor;}
  h1[data-number="14"]{counter-set:figure-counter-major 14;counter-reset:figure-counter-minor;}
  h1[data-number="15"]{counter-set:figure-counter-major 15;counter-reset:figure-counter-minor;}
  h1[data-number="16"]{counter-set:figure-counter-major 16;counter-reset:figure-counter-minor;}
  h1[data-number="17"]{counter-set:figure-counter-major 17;counter-reset:figure-counter-minor;}
  h1[data-number="18"]{counter-set:figure-counter-major 18;counter-reset:figure-counter-minor;}
  h1[data-number="19"]{counter-set:figure-counter-major 19;counter-reset:figure-counter-minor;}
  h1[data-number="20"]{counter-set:figure-counter-major 20;counter-reset:figure-counter-minor;}
  h1[data-number="21"]{counter-set:figure-counter-major 21;counter-reset:figure-counter-minor;}
  h1[data-number="22"]{counter-set:figure-counter-major 22;counter-reset:figure-counter-minor;}
  h1[data-number="23"]{counter-set:figure-counter-major 23;counter-reset:figure-counter-minor;}
  h1[data-number="24"]{counter-set:figure-counter-major 24;counter-reset:figure-counter-minor;}
  h1[data-number="25"]{counter-set:figure-counter-major 25;counter-reset:figure-counter-minor;}
  h1[data-number="26"]{counter-set:figure-counter-major 26;counter-reset:figure-counter-minor;}
  h1[data-number="27"]{counter-set:figure-counter-major 27;counter-reset:figure-counter-minor;}
  h1[data-number="28"]{counter-set:figure-counter-major 28;counter-reset:figure-counter-minor;}
  h1[data-number="29"]{counter-set:figure-counter-major 29;counter-reset:figure-counter-minor;}
  h1[data-number="30"]{counter-set:figure-counter-major 30;counter-reset:figure-counter-minor;}
  h1[data-number="31"]{counter-set:figure-counter-major 31;counter-reset:figure-counter-minor;}
  h1[data-number="32"]{counter-set:figure-counter-major 32;counter-reset:figure-counter-minor;}
  h1[data-number="33"]{counter-set:figure-counter-major 33;counter-reset:figure-counter-minor;}
  h1[data-number="34"]{counter-set:figure-counter-major 34;counter-reset:figure-counter-minor;}
  h1[data-number="35"]{counter-set:figure-counter-major 35;counter-reset:figure-counter-minor;}
  h1[data-number="36"]{counter-set:figure-counter-major 36;counter-reset:figure-counter-minor;}
  h1[data-number="37"]{counter-set:figure-counter-major 37;counter-reset:figure-counter-minor;}
  h1[data-number="38"]{counter-set:figure-counter-major 38;counter-reset:figure-counter-minor;}
  h1[data-number="39"]{counter-set:figure-counter-major 39;counter-reset:figure-counter-minor;}
  h1[data-number="40"]{counter-set:figure-counter-major 40;counter-reset:figure-counter-minor;}
  h1[data-number="41"]{counter-set:figure-counter-major 41;counter-reset:figure-counter-minor;}
  h1[data-number="42"]{counter-set:figure-counter-major 42;counter-reset:figure-counter-minor;}
  h1[data-number="43"]{counter-set:figure-counter-major 43;counter-reset:figure-counter-minor;}
  h1[data-number="44"]{counter-set:figure-counter-major 44;counter-reset:figure-counter-minor;}
  h1[data-number="45"]{counter-set:figure-counter-major 45;counter-reset:figure-counter-minor;}
  h1[data-number="46"]{counter-set:figure-counter-major 46;counter-reset:figure-counter-minor;}
  h1[data-number="47"]{counter-set:figure-counter-major 47;counter-reset:figure-counter-minor;}
  h1[data-number="48"]{counter-set:figure-counter-major 48;counter-reset:figure-counter-minor;}
  h1[data-number="49"]{counter-set:figure-counter-major 49;counter-reset:figure-counter-minor;}
  h1[data-number="50"]{counter-set:figure-counter-major 50;counter-reset:figure-counter-minor;}
  h1[data-number="51"]{counter-set:figure-counter-major 51;counter-reset:figure-counter-minor;}
  h1[data-number="52"]{counter-set:figure-counter-major 52;counter-reset:figure-counter-minor;}
  h1[data-number="53"]{counter-set:figure-counter-major 53;counter-reset:figure-counter-minor;}
  h1[data-number="54"]{counter-set:figure-counter-major 54;counter-reset:figure-counter-minor;}
  h1[data-number="55"]{counter-set:figure-counter-major 55;counter-reset:figure-counter-minor;}
  h1[data-number="56"]{counter-set:figure-counter-major 56;counter-reset:figure-counter-minor;}
  h1[data-number="57"]{counter-set:figure-counter-major 57;counter-reset:figure-counter-minor;}
  h1[data-number="58"]{counter-set:figure-counter-major 58;counter-reset:figure-counter-minor;}
  h1[data-number="59"]{counter-set:figure-counter-major 59;counter-reset:figure-counter-minor;}
  h1[data-number="60"]{counter-set:figure-counter-major 60;counter-reset:figure-counter-minor;}
  h1[data-number="61"]{counter-set:figure-counter-major 61;counter-reset:figure-counter-minor;}
  h1[data-number="62"]{counter-set:figure-counter-major 62;counter-reset:figure-counter-minor;}
  h1[data-number="63"]{counter-set:figure-counter-major 63;counter-reset:figure-counter-minor;}
  h1[data-number="64"]{counter-set:figure-counter-major 64;counter-reset:figure-counter-minor;}
  h1[data-number="65"]{counter-set:figure-counter-major 65;counter-reset:figure-counter-minor;}
  h1[data-number="66"]{counter-set:figure-counter-major 66;counter-reset:figure-counter-minor;}
  h1[data-number="67"]{counter-set:figure-counter-major 67;counter-reset:figure-counter-minor;}
  h1[data-number="68"]{counter-set:figure-counter-major 68;counter-reset:figure-counter-minor;}
  h1[data-number="69"]{counter-set:figure-counter-major 69;counter-reset:figure-counter-minor;}
  h1[data-number="70"]{counter-set:figure-counter-major 70;counter-reset:figure-counter-minor;}
  h1[data-number="71"]{counter-set:figure-counter-major 71;counter-reset:figure-counter-minor;}
  h1[data-number="72"]{counter-set:figure-counter-major 72;counter-reset:figure-counter-minor;}
  h1[data-number="73"]{counter-set:figure-counter-major 73;counter-reset:figure-counter-minor;}
  h1[data-number="74"]{counter-set:figure-counter-major 74;counter-reset:figure-counter-minor;}
  h1[data-number="75"]{counter-set:figure-counter-major 75;counter-reset:figure-counter-minor;}
  h1[data-number="76"]{counter-set:figure-counter-major 76;counter-reset:figure-counter-minor;}
  h1[data-number="77"]{counter-set:figure-counter-major 77;counter-reset:figure-counter-minor;}
  h1[data-number="78"]{counter-set:figure-counter-major 78;counter-reset:figure-counter-minor;}
  h1[data-number="79"]{counter-set:figure-counter-major 79;counter-reset:figure-counter-minor;}
  h1[data-number="80"]{counter-set:figure-counter-major 80;counter-reset:figure-counter-minor;}
  h1[data-number="81"]{counter-set:figure-counter-major 81;counter-reset:figure-counter-minor;}
  h1[data-number="82"]{counter-set:figure-counter-major 82;counter-reset:figure-counter-minor;}
  h1[data-number="83"]{counter-set:figure-counter-major 83;counter-reset:figure-counter-minor;}
  h1[data-number="84"]{counter-set:figure-counter-major 84;counter-reset:figure-counter-minor;}
  h1[data-number="85"]{counter-set:figure-counter-major 85;counter-reset:figure-counter-minor;}
  h1[data-number="86"]{counter-set:figure-counter-major 86;counter-reset:figure-counter-minor;}
  h1[data-number="87"]{counter-set:figure-counter-major 87;counter-reset:figure-counter-minor;}
  h1[data-number="88"]{counter-set:figure-counter-major 88;counter-reset:figure-counter-minor;}
  h1[data-number="89"]{counter-set:figure-counter-major 89;counter-reset:figure-counter-minor;}
  h1[data-number="90"]{counter-set:figure-counter-major 90;counter-reset:figure-counter-minor;}
  h1[data-number="91"]{counter-set:figure-counter-major 91;counter-reset:figure-counter-minor;}
  h1[data-number="92"]{counter-set:figure-counter-major 92;counter-reset:figure-counter-minor;}
  h1[data-number="93"]{counter-set:figure-counter-major 93;counter-reset:figure-counter-minor;}
  h1[data-number="94"]{counter-set:figure-counter-major 94;counter-reset:figure-counter-minor;}
  h1[data-number="95"]{counter-set:figure-counter-major 95;counter-reset:figure-counter-minor;}
  h1[data-number="96"]{counter-set:figure-counter-major 96;counter-reset:figure-counter-minor;}
  h1[data-number="97"]{counter-set:figure-counter-major 97;counter-reset:figure-counter-minor;}
  h1[data-number="98"]{counter-set:figure-counter-major 98;counter-reset:figure-counter-minor;}
  h1[data-number="99"]{counter-set:figure-counter-major 99;counter-reset:figure-counter-minor;}


  </style>
  <!-- BG custom styling for the wide body variant -->
  <!-- Gets appended after bg-css.html -->

  <style type="text/css">
  body {
      max-width: inherit;
  }
  </style>
</head>
<body>
<div style="text-align:center"><span><a href="signals.html" rel="prev">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="fifos.html" rel="next">Next</a></span></div><hr>
<h1 data-number="4" id="pipes"><span class="header-section-number">4</span> Pipes</h1>
<p>There is no form of IPC that is simpler than pipes. Implemented on every flavor of Unix, <code>pipe()</code> and <a href="fork.html#fork"><code>fork()</code></a> make up the functionality behind the “<code>|</code>” in “<code>ls | more</code>”. They are marginally useful for cool things, but are a good way to learn about basic methods of IPC.</p>
<p>Since they’re so very very easy, I shant spend much time on them. We’ll just have some examples and stuff.</p>
<h2 data-number="4.1" id="these-pipes-are-clean"><span class="header-section-number">4.1</span> “These pipes are clean!”</h2>
<p>Wait! Not so fast. I might need to define a “file descriptor” at this point. Let me put it this way: you know about “<code>FILE*</code>” from <code>stdio.h</code>, right? You know how you have all those nice functions like <code>fopen()</code>, <code>fclose()</code>, <code>fwrite()</code>, and so on? Well, those are actually high level functions that are implemented using <em>file descriptors</em>, which use system calls such as <code>open()</code>, <code>creat()</code>, <code>close()</code>, and <code>write()</code>. File descriptors are simply <code>ints</code> that are analogous to <code>FILE*</code>’s in <code>stdio.h</code>.</p>
<p>For example, <code>stdin</code> is file descriptor “0”, <code>stdout</code> is “1”, and <code>stderr</code> is “2”. Likewise, any files you open using <code>fopen()</code> get their own file descriptor, although this detail is hidden from you. (This file descriptor can be retrived from the <code>FILE*</code> by using the <code>fileno()</code> macro from <code>stdio.h</code>.)</p>
<figure>
<embed src="pipe1.svg" title="[How a pipe is organized]" />
<figcaption aria-hidden="true">How a pipe is organized.</figcaption>
</figure>
<p>Basically, a call to the <code>pipe()</code> function returns a pair of file descriptors. One of these descriptors is connected to the write end of the pipe, and the other is connected to the read end. Anything can be written to the pipe, and read from the other end in the order it came in. On many systems, pipes will fill up after you write about 10K to them without reading anything out.</p>
<p>As a <a href="https://beej.us/guide/bgipc/source/examples/pipe1.c">useless example</a><a href="references.html#fn26" class="footnote-ref" id="fnref26" role="doc-noteref"><sup>26</sup></a>, the following program creates, writes to, and reads from a pipe.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb14-1"><a href="pipes.html#cb14-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb14-2"><a href="pipes.html#cb14-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb14-3"><a href="pipes.html#cb14-3"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb14-4"><a href="pipes.html#cb14-4"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb14-5"><a href="pipes.html#cb14-5"></a></span>
<span id="cb14-6"><a href="pipes.html#cb14-6"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb14-7"><a href="pipes.html#cb14-7"></a><span class="op">{</span></span>
<span id="cb14-8"><a href="pipes.html#cb14-8"></a>    <span class="dt">int</span> pfds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb14-9"><a href="pipes.html#cb14-9"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">30</span><span class="op">];</span></span>
<span id="cb14-10"><a href="pipes.html#cb14-10"></a></span>
<span id="cb14-11"><a href="pipes.html#cb14-11"></a>    <span class="cf">if</span> <span class="op">(</span>pipe<span class="op">(</span>pfds<span class="op">)</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-12"><a href="pipes.html#cb14-12"></a>        perror<span class="op">(</span><span class="st">&quot;pipe&quot;</span><span class="op">);</span></span>
<span id="cb14-13"><a href="pipes.html#cb14-13"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb14-14"><a href="pipes.html#cb14-14"></a>    <span class="op">}</span></span>
<span id="cb14-15"><a href="pipes.html#cb14-15"></a></span>
<span id="cb14-16"><a href="pipes.html#cb14-16"></a>    printf<span class="op">(</span><span class="st">&quot;writing to file descriptor #</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> pfds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb14-17"><a href="pipes.html#cb14-17"></a>    write<span class="op">(</span>pfds<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">&quot;test&quot;</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb14-18"><a href="pipes.html#cb14-18"></a>    printf<span class="op">(</span><span class="st">&quot;reading from file descriptor #</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> pfds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb14-19"><a href="pipes.html#cb14-19"></a>    read<span class="op">(</span>pfds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> buf<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb14-20"><a href="pipes.html#cb14-20"></a>    printf<span class="op">(</span><span class="st">&quot;read </span><span class="sc">\&quot;%s\&quot;\n</span><span class="st">&quot;</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb14-21"><a href="pipes.html#cb14-21"></a></span>
<span id="cb14-22"><a href="pipes.html#cb14-22"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb14-23"><a href="pipes.html#cb14-23"></a><span class="op">}</span></span></code></pre></div>
<p>As you can see, <code>pipe()</code> takes an array of two <code>int</code>s as an argument. Assuming no errors, it connects two file descriptors and returns them in the array. The first element of the array is the reading-end of the pipe, the second is the writing end.</p>
<h2 data-number="4.2" id="fork-and-pipeyou-have-the-power"><span class="header-section-number">4.2</span> <code>fork()</code> and <code>pipe()</code>—you have the power!</h2>
<p>From the above example, it’s pretty hard to see how these would even be useful. Well, since this is an IPC document, let’s put a <code>fork()</code> in the mix and see what happens. Pretend that you are a top federal agent assigned to get a child process to send the word “test” to the parent. Not very glamorous, but no one ever said computer science would be the X-Files, Mulder.</p>
<p>First, we’ll have the parent make a pipe. Secondly, we’ll <code>fork()</code>. Now, the <code>fork()</code> man page tells us that the child will receive a copy of all the parent’s file descriptors, and this includes a copy of the pipe’s file descriptors. <em>Alors</em>, the child will be able to send stuff to the write-end of the pipe, and the parent will get it off the read-end. <a href="https://beej.us/guide/bgipc/source/examples/pipe2.c">Like this</a><a href="references.html#fn27" class="footnote-ref" id="fnref27" role="doc-noteref"><sup>27</sup></a>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb15-1"><a href="pipes.html#cb15-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb15-2"><a href="pipes.html#cb15-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb15-3"><a href="pipes.html#cb15-3"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb15-4"><a href="pipes.html#cb15-4"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb15-5"><a href="pipes.html#cb15-5"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb15-6"><a href="pipes.html#cb15-6"></a></span>
<span id="cb15-7"><a href="pipes.html#cb15-7"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb15-8"><a href="pipes.html#cb15-8"></a><span class="op">{</span></span>
<span id="cb15-9"><a href="pipes.html#cb15-9"></a>    <span class="dt">int</span> pfds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb15-10"><a href="pipes.html#cb15-10"></a>    <span class="dt">char</span> buf<span class="op">[</span><span class="dv">30</span><span class="op">];</span></span>
<span id="cb15-11"><a href="pipes.html#cb15-11"></a></span>
<span id="cb15-12"><a href="pipes.html#cb15-12"></a>    pipe<span class="op">(</span>pfds<span class="op">);</span></span>
<span id="cb15-13"><a href="pipes.html#cb15-13"></a></span>
<span id="cb15-14"><a href="pipes.html#cb15-14"></a>    <span class="cf">if</span> <span class="op">(!</span>fork<span class="op">())</span> <span class="op">{</span></span>
<span id="cb15-15"><a href="pipes.html#cb15-15"></a>        printf<span class="op">(</span><span class="st">&quot; CHILD: writing to the pipe</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb15-16"><a href="pipes.html#cb15-16"></a>        write<span class="op">(</span>pfds<span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="st">&quot;test&quot;</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb15-17"><a href="pipes.html#cb15-17"></a>        printf<span class="op">(</span><span class="st">&quot; CHILD: exiting</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb15-18"><a href="pipes.html#cb15-18"></a>        exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb15-19"><a href="pipes.html#cb15-19"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb15-20"><a href="pipes.html#cb15-20"></a>        printf<span class="op">(</span><span class="st">&quot;PARENT: reading from pipe</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb15-21"><a href="pipes.html#cb15-21"></a>        read<span class="op">(</span>pfds<span class="op">[</span><span class="dv">0</span><span class="op">],</span> buf<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb15-22"><a href="pipes.html#cb15-22"></a>        printf<span class="op">(</span><span class="st">&quot;PARENT: read </span><span class="sc">\&quot;%s\&quot;\n</span><span class="st">&quot;</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb15-23"><a href="pipes.html#cb15-23"></a>        wait<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb15-24"><a href="pipes.html#cb15-24"></a>    <span class="op">}</span></span>
<span id="cb15-25"><a href="pipes.html#cb15-25"></a></span>
<span id="cb15-26"><a href="pipes.html#cb15-26"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb15-27"><a href="pipes.html#cb15-27"></a><span class="op">}</span></span></code></pre></div>
<p>Please note, your programs should have a lot more error checking than mine do. I leave it out on occasion to help keep things clear.</p>
<p>Anyway, this example is just like the previous one, except now we <code>fork()</code> of a new process and have it write to the pipe, while the parent reads from it. The resultant output will be something similar to the following:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb16-1"><a href="pipes.html#cb16-1" aria-hidden="true" tabindex="-1"></a>PARENT: reading from pipe</span>
<span id="cb16-2"><a href="pipes.html#cb16-2" aria-hidden="true" tabindex="-1"></a> CHILD: writing to the pipe</span>
<span id="cb16-3"><a href="pipes.html#cb16-3" aria-hidden="true" tabindex="-1"></a> CHILD: exiting</span>
<span id="cb16-4"><a href="pipes.html#cb16-4" aria-hidden="true" tabindex="-1"></a>PARENT: read &quot;test&quot;</span></code></pre></div>
<p>In this case, the parent tried to read from the pipe before the child writes to it. When this happens, the parent is said to <em>block</em>, or sleep, until data arrives to be read. It seems that the parent tried to read, went to sleep, the child wrote and exited, and the parent woke up and read the data.</p>
<p>Hurrah!! You’ve just done some interprocess communication! That was dreadfully simple, huh? I’ll bet you are still thinking that there aren’t many uses for <code>pipe()</code> and, well, you’re probably right. The other forms of IPC are generally more useful and are often more exotic.</p>
<h2 data-number="4.3" id="the-search-for-pipe-as-we-know-it"><span class="header-section-number">4.3</span> The search for Pipe as we know it</h2>
<p>In an effort to make you think that pipes are actually reasonable beasts, I’ll give you an example of using <code>pipe()</code> in a more familiar situation. The challenge: implement “<code>ls | wc -l</code>” in C.</p>
<p>This requires usage of a couple more functions you may never have heard of: <code>exec()</code> and <code>dup()</code>. The <code>exec()</code> family of functions replaces the currently running process with whichever one is passed to <code>exec()</code>. This is the function that we will use to run <code>ls</code> and <code>wc -l</code>. <code>dup()</code> takes an open file descriptor and makes a clone (a duplicate) of it. This is how we will connect the standard output of the <code>ls</code> to the standard input of <code>wc</code>. See, stdout of <code>ls</code> flows into the pipe, and the stdin of <code>wc</code> flows in from the pipe. The pipe fits right there in the middle!</p>
<p>Anyway, <a href="https://beej.us/guide/bgipc/source/examples/pipe3.c">here is the code</a><a href="references.html#fn28" class="footnote-ref" id="fnref28" role="doc-noteref"><sup>28</sup></a>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb17-1"><a href="pipes.html#cb17-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb17-2"><a href="pipes.html#cb17-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb17-3"><a href="pipes.html#cb17-3"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb17-4"><a href="pipes.html#cb17-4"></a></span>
<span id="cb17-5"><a href="pipes.html#cb17-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb17-6"><a href="pipes.html#cb17-6"></a><span class="op">{</span></span>
<span id="cb17-7"><a href="pipes.html#cb17-7"></a>    <span class="dt">int</span> pfds<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb17-8"><a href="pipes.html#cb17-8"></a></span>
<span id="cb17-9"><a href="pipes.html#cb17-9"></a>    pipe<span class="op">(</span>pfds<span class="op">);</span></span>
<span id="cb17-10"><a href="pipes.html#cb17-10"></a></span>
<span id="cb17-11"><a href="pipes.html#cb17-11"></a>    <span class="cf">if</span> <span class="op">(!</span>fork<span class="op">())</span> <span class="op">{</span></span>
<span id="cb17-12"><a href="pipes.html#cb17-12"></a>        close<span class="op">(</span><span class="dv">1</span><span class="op">);</span>       <span class="co">/* close normal stdout */</span></span>
<span id="cb17-13"><a href="pipes.html#cb17-13"></a>        dup<span class="op">(</span>pfds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span>   <span class="co">/* make stdout same as pfds[1] */</span></span>
<span id="cb17-14"><a href="pipes.html#cb17-14"></a>        close<span class="op">(</span>pfds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span> <span class="co">/* we don&#39;t need this */</span></span>
<span id="cb17-15"><a href="pipes.html#cb17-15"></a>        execlp<span class="op">(</span><span class="st">&quot;ls&quot;</span><span class="op">,</span> <span class="st">&quot;ls&quot;</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb17-16"><a href="pipes.html#cb17-16"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb17-17"><a href="pipes.html#cb17-17"></a>        close<span class="op">(</span><span class="dv">0</span><span class="op">);</span>       <span class="co">/* close normal stdin */</span></span>
<span id="cb17-18"><a href="pipes.html#cb17-18"></a>        dup<span class="op">(</span>pfds<span class="op">[</span><span class="dv">0</span><span class="op">]);</span>   <span class="co">/* make stdin same as pfds[0] */</span></span>
<span id="cb17-19"><a href="pipes.html#cb17-19"></a>        close<span class="op">(</span>pfds<span class="op">[</span><span class="dv">1</span><span class="op">]);</span> <span class="co">/* we don&#39;t need this */</span></span>
<span id="cb17-20"><a href="pipes.html#cb17-20"></a>        execlp<span class="op">(</span><span class="st">&quot;wc&quot;</span><span class="op">,</span> <span class="st">&quot;wc&quot;</span><span class="op">,</span> <span class="st">&quot;-l&quot;</span><span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb17-21"><a href="pipes.html#cb17-21"></a>    <span class="op">}</span></span>
<span id="cb17-22"><a href="pipes.html#cb17-22"></a></span>
<span id="cb17-23"><a href="pipes.html#cb17-23"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb17-24"><a href="pipes.html#cb17-24"></a><span class="op">}</span></span></code></pre></div>
<p>I’m going to make another note about the <code>close()</code>/<code>dup()</code> combination since it’s pretty weird. <code>close(1)</code> frees up file descriptor 1 (standard output). <code>dup(pfds[1])</code> makes a copy of the write-end of the pipe in the first available file descriptor, which is “1”, since we just closed that. In this way, anything that <code>ls</code> writes to standard output (file descriptor 1) will instead go to <code>pfds[1]</code> (the write end of the pipe). The <code>wc</code> section of code works the same way, except in reverse.</p>
<h2 data-number="4.4" id="summary-1"><span class="header-section-number">4.4</span> Summary</h2>
<p>There aren’t many of these for such a simple topic. In fact, there are nearly just about none. Probably the best use for pipes is the one you’re most accustomed to: sending the standard output of one command to the standard input of another. For other uses, it’s pretty limiting and there are often other IPC techniques that work better.</p>
<!-- BG_NEW_CHAPTER -->
<!-- Beej's guide to IPC

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<!-- ======================================================= -->
<!-- FIFOs -->
<!-- ======================================================= -->
<hr><div style="text-align:center"><span><a href="signals.html" rel="prev">Prev</a> | </span><a href="index.html">Contents</a><span> | <a href="fifos.html" rel="next">Next</a></span></div></body>
</html>
